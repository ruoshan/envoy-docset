

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview (v2 API) &mdash; envoy tag-v1.7.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Listeners" href="../listeners/listeners.html" />
    <link rel="prev" title="Overview (v1 API)" href="v1_overview.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="v1_overview.html">Overview (v1 API)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overview (v2 API)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bootstrap-configuration">Bootstrap configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#static">Static</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mostly-static-with-dynamic-eds">Mostly static with dynamic EDS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic">Dynamic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#management-server">Management server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#grpc-streaming-endpoints">gRPC streaming endpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rest-endpoints">REST endpoints</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#aggregated-discovery-service">Aggregated Discovery Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#management-server-unreachability">Management Server Unreachability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#status">Status</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_filters/network_filters.html">Network filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_filters/http_filters.html">HTTP filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_manager/cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../health_checkers/health_checkers.html">Health checkers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access_log.html">Access logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limit.html">Rate limit service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statistics.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/router_check.html">Route table check tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v1/api.html">v1 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration reference</a> &raquo;</li>
        
      <li>Overview (v2 API)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/configuration/overview/v2_overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview-v2-api">
<span id="config-overview-v2"></span><h1>Overview (v2 API)<a class="headerlink" href="#overview-v2-api" title="Permalink to this headline">¶</a></h1>
<p>The Envoy v2 APIs are defined as <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3">proto3</a> <a class="reference external" href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> in the <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/tree/master/api">data plane API
repository</a>. They evolve the
existing <a class="reference internal" href="v1_overview.html#config-overview-v1"><span class="std std-ref">v1 APIs and concepts</span></a> to support:</p>
<ul class="simple">
<li>Streaming delivery of <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md">xDS</a>
API updates via gRPC. This reduces resource requirements and can lower the update latency.</li>
<li>A new REST-JSON API in which the JSON/YAML formats are derived mechanically via the <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#json">proto3
canonical JSON mapping</a>.</li>
<li>Delivery of updates via the filesystem, REST-JSON or gRPC endpoints.</li>
<li>Advanced load balancing through an extended endpoint assignment API and load
and resource utilization reporting to management servers.</li>
<li><a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md#eventual-consistency-considerations">Stronger consistency and ordering properties</a>
when needed. The v2 APIs still maintain a baseline eventual consistency model.</li>
</ul>
<p>See the <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md">xDS protocol description</a> for
further details on aspects of v2 message exchange between Envoy and the management server.</p>
<div class="section" id="bootstrap-configuration">
<span id="config-overview-v2-bootstrap"></span><h2>Bootstrap configuration<a class="headerlink" href="#bootstrap-configuration" title="Permalink to this headline">¶</a></h2>
<p>To use the v2 API, it’s necessary to supply a bootstrap configuration file. This
provides static server configuration and configures Envoy to access <a class="reference internal" href="../../intro/arch_overview/dynamic_configuration.html#arch-overview-dynamic-config"><span class="std std-ref">dynamic
configuration if needed</span></a>. As with the v1
JSON/YAML configuration, this is supplied on the command-line via the <a class="reference internal" href="../../operations/cli.html#cmdoption-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">-c</span></code></a>
flag, i.e.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./envoy -c &lt;path to config&gt;.{json,yaml,pb,pb_text} --v2-config-only</span>
</pre></div>
</div>
<p>where the extension reflects the underlying v2 config representation. The
<a class="reference internal" href="../../operations/cli.html#cmdoption-v2-config-only"><code class="xref std std-option docutils literal notranslate"><span class="pre">--v2-config-only</span></code></a> flag is not strictly required as Envoy will attempt
to autodetect the config file version, but this option provides an enhanced
debug experience when configuration parsing fails.</p>
<p>The <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a> message is the root of the
configuration. A key concept in the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a>
message is the distinction between static and dynamic resouces. Resources such
as a <a class="reference internal" href="../../api-v2/api/v2/lds.proto.html#envoy-api-msg-listener"><span class="std std-ref">Listener</span></a> or <a class="reference internal" href="../../api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster"><span class="std std-ref">Cluster</span></a> may be supplied either statically in
<a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-static-resources"><span class="std std-ref">static_resources</span></a> or have
an xDS service such as <a class="reference internal" href="../listeners/lds.html#config-listeners-lds"><span class="std std-ref">LDS</span></a> or <a class="reference internal" href="../cluster_manager/cds.html#config-cluster-manager-cds"><span class="std std-ref">CDS</span></a> configured in
<a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources"><span class="std std-ref">dynamic_resources</span></a>.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Below we will use YAML representation of the config protos and a running example
of a service proxying HTTP from 127.0.0.1:10000 to 127.0.0.2:1234.</p>
<div class="section" id="static">
<h3>Static<a class="headerlink" href="#static" title="Permalink to this headline">¶</a></h3>
<p>A minimal fully static bootstrap config is provided below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">access_log_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/admin_access.log</span>
  <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">9901</span> <span class="p p-Indicator">}</span>

<span class="l l-Scalar l-Scalar-Plain">static_resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">listeners</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">listener_0</span>
    <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">10000</span> <span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">filter_chains</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.http_connection_manager</span>
        <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">stat_prefix</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
          <span class="l l-Scalar l-Scalar-Plain">codec_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AUTO</span>
          <span class="l l-Scalar l-Scalar-Plain">route_config</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_route</span>
            <span class="l l-Scalar l-Scalar-Plain">virtual_hosts</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_service</span>
              <span class="l l-Scalar l-Scalar-Plain">domains</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
              <span class="l l-Scalar l-Scalar-Plain">routes</span><span class="p p-Indicator">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">match</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">prefix</span><span class="p p-Indicator">:</span> <span class="s">&quot;/&quot;</span> <span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">route</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">cluster</span><span class="p p-Indicator">:</span> <span class="nv">some_service</span> <span class="p p-Indicator">}</span>
          <span class="l l-Scalar l-Scalar-Plain">http_filters</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.router</span>
  <span class="l l-Scalar l-Scalar-Plain">clusters</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_service</span>
    <span class="l l-Scalar l-Scalar-Plain">connect_timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.25s</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">STATIC</span>
    <span class="l l-Scalar l-Scalar-Plain">lb_policy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
    <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[{</span> <span class="nv">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.2</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">1234</span> <span class="p p-Indicator">}}]</span>
</pre></div>
</div>
</div>
<div class="section" id="mostly-static-with-dynamic-eds">
<h3>Mostly static with dynamic EDS<a class="headerlink" href="#mostly-static-with-dynamic-eds" title="Permalink to this headline">¶</a></h3>
<p>A bootstrap config that continues from the above example with <a class="reference internal" href="../../intro/arch_overview/dynamic_configuration.html#arch-overview-dynamic-config-sds"><span class="std std-ref">dynamic endpoint
discovery</span></a> via an
<a class="reference internal" href="../../api-v2/api/v2/eds.proto.html#envoy-api-file-envoy-api-v2-eds-proto"><span class="std std-ref">EDS</span></a> gRPC management server listening
on 127.0.0.3:5678 is provided below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">access_log_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/admin_access.log</span>
  <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">9901</span> <span class="p p-Indicator">}</span>

<span class="l l-Scalar l-Scalar-Plain">static_resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">listeners</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">listener_0</span>
    <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">10000</span> <span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">filter_chains</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.http_connection_manager</span>
        <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">stat_prefix</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
          <span class="l l-Scalar l-Scalar-Plain">codec_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AUTO</span>
          <span class="l l-Scalar l-Scalar-Plain">route_config</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_route</span>
            <span class="l l-Scalar l-Scalar-Plain">virtual_hosts</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_service</span>
              <span class="l l-Scalar l-Scalar-Plain">domains</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
              <span class="l l-Scalar l-Scalar-Plain">routes</span><span class="p p-Indicator">:</span>
              <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">match</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">prefix</span><span class="p p-Indicator">:</span> <span class="s">&quot;/&quot;</span> <span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">route</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">cluster</span><span class="p p-Indicator">:</span> <span class="nv">some_service</span> <span class="p p-Indicator">}</span>
          <span class="l l-Scalar l-Scalar-Plain">http_filters</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.router</span>
  <span class="l l-Scalar l-Scalar-Plain">clusters</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_service</span>
    <span class="l l-Scalar l-Scalar-Plain">connect_timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.25s</span>
    <span class="l l-Scalar l-Scalar-Plain">lb_policy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">EDS</span>
    <span class="l l-Scalar l-Scalar-Plain">eds_cluster_config</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">eds_config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
          <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">xds_cluster</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">xds_cluster</span>
    <span class="l l-Scalar l-Scalar-Plain">connect_timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.25s</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">STATIC</span>
    <span class="l l-Scalar l-Scalar-Plain">lb_policy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
    <span class="l l-Scalar l-Scalar-Plain">http2_protocol_options</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[{</span> <span class="nv">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.3</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">5678</span> <span class="p p-Indicator">}}]</span>
</pre></div>
</div>
<p>Notice above that <em>xds_cluster</em> is defined to point Envoy at the management server. Even in
an otherwise completely dynamic configurations, some static resources need to
be defined to point Envoy at its xDS management server(s).</p>
<p>In the above example, the EDS management server could then return a proto encoding of a
<a class="reference internal" href="../../api-v2/api/v2/discovery.proto.html#envoy-api-msg-discoveryresponse"><span class="std std-ref">DiscoveryResponse</span></a>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version_info</span><span class="p p-Indicator">:</span> <span class="s">&quot;0&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.api.v2.ClusterLoadAssignment</span>
  <span class="l l-Scalar l-Scalar-Plain">cluster_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_service</span>
  <span class="l l-Scalar l-Scalar-Plain">endpoints</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lb_endpoints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">endpoint</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.2</span>
            <span class="l l-Scalar l-Scalar-Plain">port_value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1234</span>
</pre></div>
</div>
<p>The versioning and type URL scheme that appear above are explained in more
detail in the <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md#streaming-grpc-subscriptions">streaming gRPC subscription protocol</a>
documentation.</p>
</div>
<div class="section" id="dynamic">
<h3>Dynamic<a class="headerlink" href="#dynamic" title="Permalink to this headline">¶</a></h3>
<p>A fully dynamic bootstrap configuration, in which all resources other than
those belonging to the management server are discovered via xDS is provided
below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">access_log_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/admin_access.log</span>
  <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">9901</span> <span class="p p-Indicator">}</span>

<span class="l l-Scalar l-Scalar-Plain">dynamic_resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">lds_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
      <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">xds_cluster</span><span class="p p-Indicator">]</span>
  <span class="l l-Scalar l-Scalar-Plain">cds_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
      <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">xds_cluster</span><span class="p p-Indicator">]</span>

<span class="l l-Scalar l-Scalar-Plain">static_resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">clusters</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">xds_cluster</span>
    <span class="l l-Scalar l-Scalar-Plain">connect_timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.25s</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">STATIC</span>
    <span class="l l-Scalar l-Scalar-Plain">lb_policy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
    <span class="l l-Scalar l-Scalar-Plain">http2_protocol_options</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[{</span> <span class="nv">socket_address</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">address</span><span class="p p-Indicator">:</span> <span class="nv">127.0.0.3</span><span class="p p-Indicator">,</span> <span class="nv">port_value</span><span class="p p-Indicator">:</span> <span class="nv">5678</span> <span class="p p-Indicator">}}]</span>
</pre></div>
</div>
<p>The management server could respond to LDS requests with:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version_info</span><span class="p p-Indicator">:</span> <span class="s">&quot;0&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.api.v2.Listener</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">listener_0</span>
  <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">port_value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10000</span>
  <span class="l l-Scalar l-Scalar-Plain">filter_chains</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.http_connection_manager</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">stat_prefix</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
        <span class="l l-Scalar l-Scalar-Plain">codec_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AUTO</span>
        <span class="l l-Scalar l-Scalar-Plain">rds</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">route_config_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_route</span>
          <span class="l l-Scalar l-Scalar-Plain">config_source</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
              <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">xds_cluster</span><span class="p p-Indicator">]</span>
        <span class="l l-Scalar l-Scalar-Plain">http_filters</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.router</span>
</pre></div>
</div>
<p>The management server could respond to RDS requests with:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version_info</span><span class="p p-Indicator">:</span> <span class="s">&quot;0&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.api.v2.RouteConfiguration</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_route</span>
  <span class="l l-Scalar l-Scalar-Plain">virtual_hosts</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local_service</span>
    <span class="l l-Scalar l-Scalar-Plain">domains</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">routes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">match</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">prefix</span><span class="p p-Indicator">:</span> <span class="s">&quot;/&quot;</span> <span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">route</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">cluster</span><span class="p p-Indicator">:</span> <span class="nv">some_service</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>The management server could respond to CDS requests with:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version_info</span><span class="p p-Indicator">:</span> <span class="s">&quot;0&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.api.v2.Cluster</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_service</span>
  <span class="l l-Scalar l-Scalar-Plain">connect_timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.25s</span>
  <span class="l l-Scalar l-Scalar-Plain">lb_policy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ROUND_ROBIN</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">EDS</span>
  <span class="l l-Scalar l-Scalar-Plain">eds_cluster_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">eds_config</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
        <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The management server could respond to EDS requests with:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version_info</span><span class="p p-Indicator">:</span> <span class="s">&quot;0&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.api.v2.ClusterLoadAssignment</span>
  <span class="l l-Scalar l-Scalar-Plain">cluster_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_service</span>
  <span class="l l-Scalar l-Scalar-Plain">endpoints</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lb_endpoints</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">endpoint</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">socket_address</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.2</span>
            <span class="l l-Scalar l-Scalar-Plain">port_value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1234</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="management-server">
<h2>Management server<a class="headerlink" href="#management-server" title="Permalink to this headline">¶</a></h2>
<p>A v2 xDS management server will implement the below endpoints as required for
gRPC and/or REST serving. In both streaming gRPC and
REST-JSON cases, a <a class="reference internal" href="../../api-v2/api/v2/discovery.proto.html#envoy-api-msg-discoveryrequest"><span class="std std-ref">DiscoveryRequest</span></a> is sent and a
<a class="reference internal" href="../../api-v2/api/v2/discovery.proto.html#envoy-api-msg-discoveryresponse"><span class="std std-ref">DiscoveryResponse</span></a> received following the
<a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md">xDS protocol</a>.</p>
<div class="section" id="grpc-streaming-endpoints">
<span id="v2-grpc-streaming-endpoints"></span><h3>gRPC streaming endpoints<a class="headerlink" href="#grpc-streaming-endpoints" title="Permalink to this headline">¶</a></h3>
<dl class="post">
<dt id="post--envoy.api.v2.ClusterDiscoveryService-StreamClusters">
<code class="descname">POST </code><code class="descname">/envoy.api.v2.ClusterDiscoveryService/StreamClusters</code><a class="headerlink" href="#post--envoy.api.v2.ClusterDiscoveryService-StreamClusters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/cds.proto">cds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources"><span class="std std-ref">dynamic_resources</span></a> of the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a> config.</p>
<dl class="post">
<dt id="post--envoy.api.v2.EndpointDiscoveryService-StreamEndpoints">
<code class="descname">POST </code><code class="descname">/envoy.api.v2.EndpointDiscoveryService/StreamEndpoints</code><a class="headerlink" href="#post--envoy.api.v2.EndpointDiscoveryService-StreamEndpoints" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/eds.proto">eds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">eds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/api/v2/cds.proto.html#envoy-api-field-cluster-eds-cluster-config"><span class="std std-ref">eds_cluster_config</span></a> field of the <a class="reference internal" href="../../api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster"><span class="std std-ref">Cluster</span></a> config.</p>
<dl class="post">
<dt id="post--envoy.api.v2.ListenerDiscoveryService-StreamListeners">
<code class="descname">POST </code><code class="descname">/envoy.api.v2.ListenerDiscoveryService/StreamListeners</code><a class="headerlink" href="#post--envoy.api.v2.ListenerDiscoveryService-StreamListeners" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/lds.proto">lds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">lds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources"><span class="std std-ref">dynamic_resources</span></a> of the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a> config.</p>
<dl class="post">
<dt id="post--envoy.api.v2.RouteDiscoveryService-StreamRoutes">
<code class="descname">POST </code><code class="descname">/envoy.api.v2.RouteDiscoveryService/StreamRoutes</code><a class="headerlink" href="#post--envoy.api.v2.RouteDiscoveryService-StreamRoutes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/rds.proto">rds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">route_config_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_route_name</span>
<span class="l l-Scalar l-Scalar-Plain">config_source</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds"><span class="std std-ref">rds</span></a> field of the <a class="reference internal" href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-msg-config-filter-network-http-connection-manager-v2-httpconnectionmanager"><span class="std std-ref">HttpConnectionManager</span></a> config.</p>
</div>
<div class="section" id="rest-endpoints">
<h3>REST endpoints<a class="headerlink" href="#rest-endpoints" title="Permalink to this headline">¶</a></h3>
<dl class="post">
<dt id="post--v2-discovery-clusters">
<code class="descname">POST </code><code class="descname">/v2/discovery:clusters</code><a class="headerlink" href="#post--v2-discovery-clusters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/cds.proto">cds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">REST</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources"><span class="std std-ref">dynamic_resources</span></a> of the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a> config.</p>
<dl class="post">
<dt id="post--v2-discovery-endpoints">
<code class="descname">POST </code><code class="descname">/v2/discovery:endpoints</code><a class="headerlink" href="#post--v2-discovery-endpoints" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/eds.proto">eds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">eds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">REST</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/api/v2/cds.proto.html#envoy-api-field-cluster-eds-cluster-config"><span class="std std-ref">eds_cluster_config</span></a> field of the <a class="reference internal" href="../../api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster"><span class="std std-ref">Cluster</span></a> config.</p>
<dl class="post">
<dt id="post--v2-discovery-listeners">
<code class="descname">POST </code><code class="descname">/v2/discovery:listeners</code><a class="headerlink" href="#post--v2-discovery-listeners" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/lds.proto">lds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">lds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">REST</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources"><span class="std std-ref">dynamic_resources</span></a> of the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a> config.</p>
<dl class="post">
<dt id="post--v2-discovery-routes">
<code class="descname">POST </code><code class="descname">/v2/discovery:routes</code><a class="headerlink" href="#post--v2-discovery-routes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/rds.proto">rds.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">route_config_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some_route_name</span>
<span class="l l-Scalar l-Scalar-Plain">config_source</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">REST</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds"><span class="std std-ref">rds</span></a> field of the <a class="reference internal" href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-msg-config-filter-network-http-connection-manager-v2-httpconnectionmanager"><span class="std std-ref">HttpConnectionManager</span></a> config.</p>
</div>
</div>
<div class="section" id="aggregated-discovery-service">
<span id="config-overview-v2-ads"></span><h2>Aggregated Discovery Service<a class="headerlink" href="#aggregated-discovery-service" title="Permalink to this headline">¶</a></h2>
<p>While Envoy fundamentally employs an eventual consistency model, ADS provides an
opportunity to sequence API update pushes and ensure affinity of a single
management server for an Envoy node for API updates. ADS allows one or more APIs
and their resources to be delivered on a single, bidirectional gRPC stream by
the management server. Without this, some APIs such as RDS and EDS may require
the management of multiple streams and connections to distinct management
servers.</p>
<p>ADS will allow for hitless updates of configuration by appropriate sequencing.
For example, suppose <em>foo.com</em> was mappped to cluster <em>X</em>. We wish to change the
mapping in the route table to point <em>foo.com</em> at cluster <em>Y</em>. In order to do
this, a CDS/EDS update must first be delivered containing both clusters <em>X</em> and
<em>Y</em>.</p>
<p>Without ADS, the CDS/EDS/RDS streams may point at distinct management servers,
or when on the same management server at distinct gRPC streams/connections that
require coordination. The EDS resource requests may be split across two distinct
streams, one for <em>X</em> and one for <em>Y</em>. ADS allows these to be coalesced to a
single stream to a single management server, avoiding the need for distributed
synchronization to correctly sequence the update. With ADS, the management
server would deliver the CDS, EDS and then RDS updates on a single stream.</p>
<p>ADS is only available for gRPC streaming (not REST) and is described more fully
in <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md#aggregated-discovery-services-ads">this</a>
document. The gRPC endpoint is:</p>
<dl class="post">
<dt id="post--envoy.api.v2.AggregatedDiscoveryService-StreamAggregatedResources">
<code class="descname">POST </code><code class="descname">/envoy.api.v2.AggregatedDiscoveryService/StreamAggregatedResources</code><a class="headerlink" href="#post--envoy.api.v2.AggregatedDiscoveryService-StreamAggregatedResources" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>See <a class="reference external" href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/discovery.proto">discovery.proto</a>
for the service definition. This is used by Envoy as a client when</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ads_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GRPC</span>
  <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_ads_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>is set in the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources"><span class="std std-ref">dynamic_resources</span></a> of the <a class="reference internal" href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap"><span class="std std-ref">Bootstrap</span></a> config.</p>
<p>When this is set, any of the configuration sources <a class="reference internal" href="#v2-grpc-streaming-endpoints"><span class="std std-ref">above</span></a> can
be set to use the ADS channel. For example, a LDS config could be changed from</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">lds_config</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">api_config_source</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">REST</span>
    <span class="l l-Scalar l-Scalar-Plain">cluster_names</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">some_xds_cluster</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">lds_config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">ads</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}}</span>
</pre></div>
</div>
<p>with the effect that the LDS stream will be directed to <em>some_ads_cluster</em> over
the shared ADS channel.</p>
</div>
<div class="section" id="management-server-unreachability">
<span id="config-overview-v2-mgmt-con-issues"></span><h2>Management Server Unreachability<a class="headerlink" href="#management-server-unreachability" title="Permalink to this headline">¶</a></h2>
<p>When Envoy instance looses connectivity with the management server, Envoy will latch on to
the previous configuration while actively retrying in the background to reestablish the
connection with the management server.</p>
<p>Envoy debug logs the fact that it is not able to establish a connection with the management server
every time it attempts a connection.</p>
<p><a class="reference internal" href="../cluster_manager/cluster_stats.html#config-cluster-manager-cluster-stats"><span class="std std-ref">upstream_cx_connect_fail</span></a> a cluster level statistic
of the cluster pointing to management server provides a signal for monitoring this behavior.</p>
</div>
<div class="section" id="status">
<span id="config-overview-v2-status"></span><h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>All features described in the <a class="reference internal" href="../../api-v2/api.html#envoy-api-reference"><span class="std std-ref">v2 API reference</span></a> are
implemented unless otherwise noted. In the v2 API reference and the
<a class="reference external" href="https://github.com/envoyproxy/data-plane-api/tree/master">v2 API repository</a>, all protos are
<em>frozen</em> unless they are tagged as <em>draft</em> or <em>experimental</em>. Here, <em>frozen</em>
means that we will not break wire format compatibility.</p>
<p><em>Frozen</em> protos may be further extended, e.g. by adding new fields, in a
manner that does not break <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/overview#how-do-they-work">backwards compatibility</a>.
Fields in the above protos may be later deprecated, subject to the
<a class="reference external" href="https://github.com/envoyproxy/envoy/blob/master//CONTRIBUTING.md#breaking-change-policy">breaking change policy</a>,
when their related functionality is no longer required. While frozen APIs
have their wire format compatibility preserved, we reserve the right to change
proto namespaces, file locations and nesting relationships, which may cause
breaking code changes. We will aim to minimize the churn here.</p>
<p>Protos tagged <em>draft</em>, meaning that they are near finalized, are
likely to be at least partially implemented in Envoy but may have wire format
breaking changes made prior to freezing.</p>
<p>Protos tagged <em>experimental</em>, have the same caveats as draft protos
and may have have major changes made prior to Envoy implementation and freezing.</p>
<p>The current open v2 API issues are tracked <a class="reference external" href="https://github.com/envoyproxy/envoy/issues?q=is%3Aopen+is%3Aissue+label%3A%22v2+API%22">here</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../listeners/listeners.html" class="btn btn-neutral float-right" title="Listeners" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="v1_overview.html" class="btn btn-neutral" title="Overview (v1 API)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'tag-v1.7.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>