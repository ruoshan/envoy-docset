

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Virtual cluster &mdash; envoy tag-v1.7.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Rate limit configuration" href="rate_limits.html" />
    <link rel="prev" title="Route" href="route.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">v1 API reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_filters/network_filters.html">Network filters</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="route_config.html">HTTP Route configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vhost.html">Virtual host</a></li>
<li class="toctree-l3"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Virtual cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="rate_limits.html">Rate limit configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="rds.html">Route discovery service (RDS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http_filters/http_filters.html">HTTP filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_manager/cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access_log.html">Access logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin.html">Administration interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limit.html">Rate limit service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracing.html">Tracing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../api.html">v1 API reference</a> &raquo;</li>
        
          <li><a href="route_config.html">HTTP Route configuration</a> &raquo;</li>
        
      <li>Virtual cluster</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api-v1/route_config/vcluster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="virtual-cluster">
<span id="config-http-conn-man-route-table-vcluster"></span><h1>Virtual cluster<a class="headerlink" href="#virtual-cluster" title="Permalink to this headline">¶</a></h1>
<p>A virtual cluster is a way of specifying a regex matching rule against certain important endpoints
such that statistics are generated explicitly for the matched requests. The reason this is useful is
that when doing prefix/path matching Envoy does not always know what the application considers to
be an endpoint. Thus, it’s impossible for Envoy to generically emit per endpoint statistics.
However, often systems have highly critical endpoints that they wish to get “perfect” statistics on.
Virtual cluster statistics are perfect in the sense that they are emitted on the downstream side
such that they include network level failures.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Virtual clusters are a useful tool, but we do not recommend setting up a virtual cluster for
every application endpoint. This is both not easily maintainable as well as the matching and
statistics output are not free.</p>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>pattern</dt>
<dd><em>(required, string)</em> Specifies a regex pattern to use for matching requests. The entire path of the request
must match the regex. The regex grammar used is defined <a class="reference external" href="http://en.cppreference.com/w/cpp/regex/ecmascript">here</a>.</dd>
<dt>name</dt>
<dd><em>(required, string)</em> Specifies the name of the virtual cluster. The virtual cluster name as well
as the virtual host name are used when emitting statistics. The statistics are emitted by the
router filter and are documented <a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-stats"><span class="std std-ref">here</span></a>.</dd>
<dt>method</dt>
<dd><p class="first"><em>(optional, string)</em> Optionally specifies the HTTP method to match on. For example <em>GET</em>, <em>PUT</em>,
etc.</p>
<p>Examples:</p>
<blockquote class="last">
<div><ul class="simple">
<li>The regex <em>/rides/d+</em> matches the path <em>/rides/0</em></li>
<li>The regex <em>/rides/d+</em> matches the path <em>/rides/123</em></li>
<li>The regex <em>/rides/d+</em> does not match the path <em>/rides/123/456</em></li>
</ul>
</div></blockquote>
</dd>
</dl>
<p>Documentation for <a class="reference internal" href="../../configuration/http_filters/router_filter.html#config-http-filters-router-stats"><span class="std std-ref">virtual cluster statistics</span></a>.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rate_limits.html" class="btn btn-neutral float-right" title="Rate limit configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="route.html" class="btn btn-neutral" title="Route" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'tag-v1.7.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>