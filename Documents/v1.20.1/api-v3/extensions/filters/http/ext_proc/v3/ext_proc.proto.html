<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>External Processing Filter &mdash; envoy tag-v1.20.1 documentation</title>
      <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/css/envoy.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../../" id="documentation_options" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="External Processing Filter" href="processing_mode.proto.html" />
    <link rel="prev" title="External Authorization" href="../../ext_authz/v3/ext_authz.proto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../../index.html">
            <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                tag-v1.20.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../../api/api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/api_supported_versions.html">Supported API versions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../api.html">v3 API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../../bootstrap/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../clusters/clusters.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../http_routes/http_routes.html">HTTP route management</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../../config/config.html">Extensions</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../../../../config/filter/filter.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/accesslog/accesslog.html">Access loggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/rbac.html">RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/health_checker/health_checker.html">Health checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/transport_socket/transport_socket.html">Transport sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/resource_monitor/resource_monitor.html">Resource monitors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/common/common.html">Common</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/compression/compression.html">Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/cluster/cluster.html">Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/grpc_credential/grpc_credential.html">Grpc Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/retry/retry.html">Retry Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/trace/trace.html">HTTP Tracers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/internal_redirect/internal_redirect.html">Internal Redirect Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/endpoint/endpoint.html">Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/upstream/upstream.html">Upstream Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/wasm/wasm.html">WASM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/watchdog/watchdog.html">Watchdog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/descriptors/descriptors.html">Rate limit descriptors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/request_id/request_id.html">Request ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/header_formatters.html">HTTP header formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/original_ip_detection.html">Original IP Detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/stat_sinks/stat_sinks.html">Stat sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/quic/quic_extensions.html">Quic Extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/formatter/formatter.html">Access log formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/contrib/contrib.html">Contrib Extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/matchers.html">RBAC Matchers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../admin/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../data/data.html">Envoy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../service/service.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../common_messages/common_messages.html">Common messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../types/types.html">Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-docs/xds_protocol.html">xDS REST and gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/client_features.html">Well Known Client Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../../../../api/api.html">API</a> &raquo;</li>
          <li><a href="../../../../../api.html">v3 API reference</a> &raquo;</li>
          <li><a href="../../../../../config/config.html">Extensions</a> &raquo;</li>
          <li><a href="../../../../../config/filter/filter.html">Filters</a> &raquo;</li>
          <li><a href="../../../../../config/filter/http/http.html">HTTP filters</a> &raquo;</li>
      <li>External Processing Filter</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../_sources/api-v3/extensions/filters/http/ext_proc/v3/ext_proc.proto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="external-processing-filter">
<span id="envoy-v3-api-file-envoy-extensions-filters-http-ext-proc-v3-ext-proc-proto"></span><h1>External Processing Filter<a class="headerlink" href="#external-processing-filter" title="Permalink to this headline">¶</a></h1>
<p id="extension-envoy-filters-http-ext-proc">This extension may be referenced by the qualified name <code class="docutils literal notranslate"><span class="pre">envoy.filters.http.ext_proc</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is functional but has not had substantial production burn time, use only with this caveat.</p>
<p>This extension has an unknown security posture and should only be used in deployments where both the downstream and upstream are trusted.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This extension extends and can be used with the following extension category:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../network/http_connection_manager/v3/http_connection_manager.proto.html#extension-category-envoy-filters-http"><span class="std std-ref">envoy.filters.http</span></a></p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This API feature is currently work-in-progress. API features marked as work-in-progress are not considered stable, are not covered by the <a class="reference internal" href="../../../../../../intro/arch_overview/security/threat_model.html#arch-overview-threat-model"><span class="std std-ref">threat model</span></a>, are not supported by the security team, and are subject to breaking changes. Do not use this feature without understanding each of the previous points.</p>
</div>
<p>External Processing Filter</p>
<p>The External Processing filter allows an external service to act on HTTP traffic in a flexible way.</p>
<p><strong>Current Implementation Status:</strong>
All options and processing modes are implemented except for the following:</p>
<ul class="simple">
<li><p>Request and response attributes are not sent and not processed.</p></li>
<li><p>Dynamic metadata in responses from the external processor is ignored.</p></li>
<li><p>“async mode” is not implemented</p></li>
<li><p>Per-route configuration is not implemented</p></li>
</ul>
<p>The filter communicates with an external gRPC service called an “external processor”
that can do a variety of things with the request and response:</p>
<ul class="simple">
<li><p>Access and modify the HTTP headers on the request, response, or both</p></li>
<li><p>Access and modify the HTTP request and response bodies</p></li>
<li><p>Access and modify the dynamic stream metadata</p></li>
<li><p>Immediately send an HTTP response downstream and terminate other processing</p></li>
</ul>
<p>The filter communicates with the server using a gRPC bidirectional stream. After the initial
request, the external server is in control over what additional data is sent to it
and how it should be processed.</p>
<p>By implementing the protocol specified by the stream, the external server can choose:</p>
<ul class="simple">
<li><p>Whether it receives the response message at all</p></li>
<li><p>Whether it receives the message body at all, in separate chunks, or as a single buffer</p></li>
<li><p>Whether subsequent HTTP requests are transmitted synchronously or whether they are
sent asynchronously.</p></li>
<li><p>To modify request or response trailers if they already exist</p></li>
<li><p>To add request or response trailers where they are not present</p></li>
</ul>
<p>The filter supports up to six different processing steps. Each is represented by
a gRPC stream message that is sent to the external processor. For each message, the
processor must send a matching response.</p>
<ul class="simple">
<li><p>Request headers: Contains the headers from the original HTTP request.</p></li>
<li><p>Request body: Sent in a single message if the BUFFERED or BUFFERED_PARTIAL
mode is chosen, in multiple messages if the STREAMED mode is chosen, and not
at all otherwise.</p></li>
<li><p>Request trailers: Delivered if they are present and if the trailer mode is set
to SEND.</p></li>
<li><p>Response headers: Contains the headers from the HTTP response. Keep in mind
that if the upstream system sends them before processing the request body that
this message may arrive before the complete body.</p></li>
<li><p>Response body: Sent according to the processing mode like the request body.</p></li>
<li><p>Response trailers: Delivered according to the processing mode like the
request trailers.</p></li>
</ul>
<p>By default, the processor sends only the request and response headers messages.
This may be changed to include any of the six steps by changing the processing_mode
setting of the filter configuration, or by setting the mode_override of any response
from the external processor. This way, a processor may, for example, use information
in the request header to determine whether the message body must be examined, or whether
the proxy should simply stream it straight through.</p>
<p>All of this together allows a server to process the filter traffic in fairly
sophisticated ways. For example:</p>
<ul class="simple">
<li><p>A server may choose to examine all or part of the HTTP message bodies depending
on the content of the headers.</p></li>
<li><p>A server may choose to immediately reject some messages based on their HTTP
headers (or other dynamic metadata) and more carefully examine others</p></li>
<li><p>A server may asynchronously monitor traffic coming through the filter by inspecting
headers, bodies, or both, and then decide to switch to a synchronous processing
mode, either permanently or temporarily.</p></li>
</ul>
<p>The protocol itself is based on a bidirectional gRPC stream. Envoy will send the
server
<a class="reference internal" href="../../../../../service/ext_proc/v3/external_processor.proto.html#envoy-v3-api-msg-service-ext-proc-v3-processingrequest"><span class="std std-ref">ProcessingRequest</span></a>
messages, and the server must reply with
<a class="reference internal" href="../../../../../service/ext_proc/v3/external_processor.proto.html#envoy-v3-api-msg-service-ext-proc-v3-processingresponse"><span class="std std-ref">ProcessingResponse</span></a>.</p>
<div class="section" id="extensions-filters-http-ext-proc-v3-externalprocessor">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-proc-v3-externalprocessor"></span><h2>extensions.filters.http.ext_proc.v3.ExternalProcessor<a class="headerlink" href="#extensions-filters-http-ext-proc-v3-externalprocessor" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.20.1/api/envoy/extensions/filters/http/ext_proc/v3/ext_proc.proto#L97">[extensions.filters.http.ext_proc.v3.ExternalProcessor proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;grpc_service&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;failure_mode_allow&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;processing_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;message_timeout&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-externalprocessor-grpc-service">
<dt>grpc_service</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/grpc_service.proto.html#envoy-v3-api-msg-config-core-v3-grpcservice"><span class="std std-ref">config.core.v3.GrpcService</span></a>) Configuration for the gRPC service that the filter will communicate with.
The filter supports both the “Envoy” and “Google” gRPC clients.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-externalprocessor-failure-mode-allow">
<dt>failure_mode_allow</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) By default, if the gRPC stream cannot be established, or if it is closed
prematurely with an error, the filter will fail. Specifically, if the
response headers have not yet been delivered, then it will return a 500
error downstream. If they have been delivered, then instead the HTTP stream to the
downstream client will be reset.
With this parameter set to true, however, then if the gRPC stream is prematurely closed
or could not be opened, processing continues without error.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-externalprocessor-processing-mode">
<dt>processing_mode</dt><dd><p>(<a class="reference internal" href="processing_mode.proto.html#envoy-v3-api-msg-extensions-filters-http-ext-proc-v3-processingmode"><span class="std std-ref">extensions.filters.http.ext_proc.v3.ProcessingMode</span></a>) Specifies default options for how HTTP headers, trailers, and bodies are
sent. See ProcessingMode for details.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-externalprocessor-message-timeout">
<dt>message_timeout</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) Specifies the timeout for each individual message sent on the stream and
when the filter is running in synchronous mode. Whenever
the proxy sends a message on the stream that requires a response, it will
reset this timer, and will stop processing and return an error (subject
to the processing mode) if the timer expires before a matching response.
is received. There is no timeout when the filter is running in asynchronous
mode. Default is 200 milliseconds.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-proc-v3-extprocperroute">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-proc-v3-extprocperroute"></span><h2>extensions.filters.http.ext_proc.v3.ExtProcPerRoute<a class="headerlink" href="#extensions-filters-http-ext-proc-v3-extprocperroute" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.20.1/api/envoy/extensions/filters/http/ext_proc/v3/ext_proc.proto#L156">[extensions.filters.http.ext_proc.v3.ExtProcPerRoute proto]</a></p>
<p>Extra settings that may be added to per-route configuration for a
virtual host or cluster.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;disabled&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;overrides&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocperroute-disabled">
<dt>disabled</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Disable the filter for this particular vhost or route.
If disabled is specified in multiple per-filter-configs, the most specific one will be used.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocperroute-disabled"><span class="std std-ref">disabled</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocperroute-overrides"><span class="std std-ref">overrides</span></a> must be set.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocperroute-overrides">
<dt>overrides</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-http-ext-proc-v3-extprocoverrides"><span class="std std-ref">extensions.filters.http.ext_proc.v3.ExtProcOverrides</span></a>) Override aspects of the configuration for this route. A set of
overrides in a more specific configuration will override a “disabled”
flag set in a less-specific one.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocperroute-disabled"><span class="std std-ref">disabled</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocperroute-overrides"><span class="std std-ref">overrides</span></a> must be set.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-proc-v3-extprocoverrides">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-proc-v3-extprocoverrides"></span><h2>extensions.filters.http.ext_proc.v3.ExtProcOverrides<a class="headerlink" href="#extensions-filters-http-ext-proc-v3-extprocoverrides" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.20.1/api/envoy/extensions/filters/http/ext_proc/v3/ext_proc.proto#L172">[extensions.filters.http.ext_proc.v3.ExtProcOverrides proto]</a></p>
<p>Overrides that may be set on a per-route basis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;processing_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-proc-v3-extprocoverrides-processing-mode">
<dt>processing_mode</dt><dd><p>(<a class="reference internal" href="processing_mode.proto.html#envoy-v3-api-msg-extensions-filters-http-ext-proc-v3-processingmode"><span class="std std-ref">extensions.filters.http.ext_proc.v3.ProcessingMode</span></a>) Set a different processing mode for this route than the default.</p>
</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../ext_authz/v3/ext_authz.proto.html" class="btn btn-neutral float-left" title="External Authorization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="processing_mode.proto.html" class="btn btn-neutral float-right" title="External Processing Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2021, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>