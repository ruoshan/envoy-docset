<svg width="835" height="678" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs style="-webkit-tap-highlight-color:transparent"><marker id="b" style="-webkit-tap-highlight-color:transparent" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use transform="rotate(180 2.5 2.5)" style="-webkit-tap-highlight-color:transparent" xlink:href="#a"/></marker><marker id="c" style="-webkit-tap-highlight-color:transparent" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use transform="rotate(180 2.5 2.5)" style="-webkit-tap-highlight-color:transparent" xlink:href="#a"/></marker><marker id="d" style="-webkit-tap-highlight-color:transparent" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use transform="rotate(180 2.5 2.5)" style="-webkit-tap-highlight-color:transparent" xlink:href="#a"/></marker><marker id="e" style="-webkit-tap-highlight-color:transparent" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use transform="rotate(180 2.5 2.5)" style="-webkit-tap-highlight-color:transparent" xlink:href="#a"/></marker><marker id="f" style="-webkit-tap-highlight-color:transparent" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use transform="rotate(180 2.5 2.5)" style="-webkit-tap-highlight-color:transparent" xlink:href="#a"/></marker><marker id="g" style="-webkit-tap-highlight-color:transparent" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use transform="rotate(180 2.5 2.5)" style="-webkit-tap-highlight-color:transparent" xlink:href="#a"/></marker><path id="a" d="M5 0 0 2.5 5 5z" stroke-linecap="round" style="-webkit-tap-highlight-color:transparent"/></defs><rect x="55.867" y="20" width="62.422" height="38.594" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="66.016" y="30" width="42.422" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="87.078" y="39.297" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">Envoy</tspan></text><rect x="55.867" y="619.7" width="62.422" height="38.594" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="66.016" y="629.7" width="42.422" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="87.078" y="639" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">Envoy</tspan></text><path d="M87.078 58.594v561.11" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="527.59" y="20" width="163.48" height="38.594" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="537.73" y="30" width="143.48" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="609.328" y="39.297" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">Management Server</tspan></text><rect x="527.59" y="619.7" width="163.48" height="38.594" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="537.73" y="629.7" width="143.48" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="609.328" y="639" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">Management Server</tspan></text><path d="M609.33 58.594v561.11" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="269.02" y="74.297" width="158.38" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="348.203" y="83.594" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">{resource_names={A}}</tspan></text><path d="M87.078 97.188h517.25" fill="none" marker-end="url(#b)" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="220.16" y="112.89" width="256.09" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="348.203" y="122.188" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">{resources={A}, version=1, nonce=1}</tspan></text><path d="M609.33 135.78H92.08" fill="none" marker-end="url(#c)" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="139.86" y="151.48" width="416.69" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="348.203" y="160.781" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">{resource_names={A}, version=1, nonce=1 (this is an ACK)}</tspan></text><path d="M87.078 174.38h517.25" fill="none" marker-end="url(#d)" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="11.891" y="194.38" width="150.38" height="47.781" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="16.891" y="199.38" width="140.38" height="37.781" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="87.078" y="218.266" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="-4.602" style="-webkit-tap-highlight-color:transparent">adding subscription</tspan><tspan x="87.078" dy="19.2" style="-webkit-tap-highlight-color:transparent">to B</tspan></text><rect x="188.02" y="257.86" width="320.38" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="348.203" y="267.156" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">{resource_names={A, B}, version=1, nonce=1}</tspan></text><path d="M87.078 280.75h517.25" fill="none" marker-end="url(#e)" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="505.25" y="300.75" width="208.16" height="86.188" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="510.25" y="305.75" width="198.16" height="76.188" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="609.328" y="343.844" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="-23.797" style="-webkit-tap-highlight-color:transparent">sends B, but system version</tspan><tspan x="609.328" dy="19.2" style="-webkit-tap-highlight-color:transparent">does not change because</tspan><tspan x="609.328" dy="19.2" style="-webkit-tap-highlight-color:transparent">server has not gotten a</tspan><tspan x="609.328" dy="19.2" style="-webkit-tap-highlight-color:transparent">new config</tspan></text><rect x="220.41" y="402.64" width="255.59" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="348.203" y="411.938" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">{resources={B}, version=1, nonce=2}</tspan></text><path d="M609.33 425.53H92.08" fill="none" marker-end="url(#f)" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="10" y="445.53" width="154.16" height="28.594" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="15" y="450.53" width="144.16" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="87.078" y="459.828" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">intending to NACK B</tspan></text><rect x="97.078" y="489.83" width="502.25" height="18.594" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="348.203" y="499.125" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="5" style="-webkit-tap-highlight-color:transparent">{resource_names={A, B}, version=1, nonce=2, error_detail=&quot;B is invalid&quot;}</tspan></text><path d="M87.078 512.72h517.25" fill="none" marker-end="url(#g)" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="505.77" y="532.72" width="207.12" height="66.984" rx="0" ry="0" fill="none" stroke="#000" stroke-width="2" style="-webkit-tap-highlight-color:transparent"/><rect x="510.77" y="537.72" width="197.12" height="56.984" rx="0" ry="0" fill="#fff" style="-webkit-tap-highlight-color:transparent"/><text x="609.328" y="566.211" font-family="Roboto" font-size="16" text-anchor="middle" style="-webkit-tap-highlight-color:transparent"><tspan dy="-14.203" style="-webkit-tap-highlight-color:transparent">needs to look at error_detail</tspan><tspan x="609.328" dy="19.2" style="-webkit-tap-highlight-color:transparent">to detect NACK instead of</tspan><tspan x="609.328" dy="19.2" style="-webkit-tap-highlight-color:transparent">using version and nonce</tspan></text></svg>