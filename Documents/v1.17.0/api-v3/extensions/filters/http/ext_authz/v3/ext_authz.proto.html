

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>External Authorization &mdash; envoy 1.17.0-5c801b documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="Fault Injection" href="../../fault/v3/fault.proto.html" />
    <link rel="prev" title="Dynamo" href="../../dynamo/v3/dynamo.proto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html">
          

          
            
            <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.17.0-5c801b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../../api/api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/api_supported_versions.html">Supported API versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../api.html">v3 API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../../bootstrap/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../clusters/clusters.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../http_routes/http_routes.html">HTTP route management</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../../config/config.html">Extensions</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../../../../config/filter/filter.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/accesslog/accesslog.html">Access loggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/rbac.html">RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/health_checker/health_checker.html">Health checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/transport_socket/transport_socket.html">Transport sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/resource_monitor/resource_monitor.html">Resource monitors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/common/common.html">Common</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/compression/compression.html">Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/cluster/cluster.html">Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/grpc_credential/grpc_credential.html">Grpc Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/retry/retry.html">Retry Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/trace/trace.html">HTTP Tracers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/internal_redirect/internal_redirect.html">Internal Redirect Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/endpoint/endpoint.html">Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/upstream/upstream.html">Upstream Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/wasm/wasm.html">WASM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/watchdog/watchdog.html">Watchdog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/descriptors/descriptors.html">Rate limit descriptors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../admin/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../data/data.html">Envoy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../service/service.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../common_messages/common_messages.html">Common messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../types/types.html">Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-docs/xds_protocol.html">xDS REST and gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/client_features.html">Well Known Client Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../../api/api.html">API</a> &raquo;</li>
        
          <li><a href="../../../../../api.html">v3 API reference</a> &raquo;</li>
        
          <li><a href="../../../../../config/config.html">Extensions</a> &raquo;</li>
        
          <li><a href="../../../../../config/filter/filter.html">Filters</a> &raquo;</li>
        
          <li><a href="../../../../../config/filter/http/http.html">HTTP filters</a> &raquo;</li>
        
      <li>External Authorization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../../_sources/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="external-authorization">
<span id="envoy-v3-api-file-envoy-extensions-filters-http-ext-authz-v3-ext-authz-proto"></span><h1>External Authorization<a class="headerlink" href="#external-authorization" title="Permalink to this headline">¶</a></h1>
<p id="extension-envoy-filters-http-ext-authz">This extension may be referenced by the qualified name <em>envoy.filters.http.ext_authz</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is intended to be robust against untrusted downstream traffic. It assumes that the upstream is trusted.</p>
</div>
<p>External Authorization <a class="reference internal" href="../../../../../../configuration/http/http_filters/ext_authz_filter.html#config-http-filters-ext-authz"><span class="std std-ref">configuration overview</span></a>.</p>
<div class="section" id="extensions-filters-http-ext-authz-v3-extauthz">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-extauthz"></span><h2>extensions.filters.http.ext_authz.v3.ExtAuthz<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-extauthz" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L27">[extensions.filters.http.ext_authz.v3.ExtAuthz proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;grpc_service&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;http_service&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;transport_api_version&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;failure_mode_allow&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;with_request_body&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clear_route_cache&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status_on_error&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;metadata_context_namespaces&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;filter_enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;filter_enabled_metadata&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;deny_at_disable&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;include_peer_certificate&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;stat_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-grpc-service">
<dt>grpc_service</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/grpc_service.proto.html#envoy-v3-api-msg-config-core-v3-grpcservice"><span class="std std-ref">config.core.v3.GrpcService</span></a>) gRPC service configuration (default timeout: 200ms).</p>
<p>External authorization service configuration.</p>
<p>Only one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-grpc-service"><span class="std std-ref">grpc_service</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-http-service"><span class="std std-ref">http_service</span></a> may be set.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-http-service">
<dt>http_service</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-httpservice"><span class="std std-ref">extensions.filters.http.ext_authz.v3.HttpService</span></a>) HTTP service configuration (default timeout: 200ms).</p>
<p>External authorization service configuration.</p>
<p>Only one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-grpc-service"><span class="std std-ref">grpc_service</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-http-service"><span class="std std-ref">http_service</span></a> may be set.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-transport-api-version">
<dt>transport_api_version</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/config_source.proto.html#envoy-v3-api-enum-config-core-v3-apiversion"><span class="std std-ref">config.core.v3.ApiVersion</span></a>) API version for ext_authz transport protocol. This describes the ext_authz gRPC endpoint and
version of messages used on the wire.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-failure-mode-allow">
<dt>failure_mode_allow</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>)  Changes filter’s behaviour on errors:</p>
<blockquote>
<div><p>1. When set to true, the filter will <em>accept</em> client request even if the communication with
the authorization service has failed, or if the authorization service has returned a HTTP 5xx
error.</p>
<p>2. When set to false, ext-authz will <em>reject</em> client requests and return a <em>Forbidden</em>
response if the communication with the authorization service has failed, or if the
authorization service has returned a HTTP 5xx error.</p>
</div></blockquote>
<p>Note that errors can be <em>always</em> tracked in the <a class="reference internal" href="../../../../../../configuration/http/http_filters/ext_authz_filter.html#config-http-filters-ext-authz-stats"><span class="std std-ref">stats</span></a>.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-with-request-body">
<dt>with_request_body</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-buffersettings"><span class="std std-ref">extensions.filters.http.ext_authz.v3.BufferSettings</span></a>) Enables filter to buffer the client request body and send it within the authorization request.
A <code class="docutils literal notranslate"><span class="pre">x-envoy-auth-partial-body:</span> <span class="pre">false|true</span></code> metadata header will be added to the authorization
request message indicating if the body data is partial.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-clear-route-cache">
<dt>clear_route_cache</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Clears route cache in order to allow the external authorization service to correctly affect
routing decisions. Filter clears all cached routes when:</p>
<ol class="arabic simple">
<li><p>The field is set to <em>true</em>.</p></li>
<li><p>The status returned from the authorization service is a HTTP 200 or gRPC 0.</p></li>
</ol>
<p>3. At least one <em>authorization response header</em> is added to the client request, or is used for
altering another client request header.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-status-on-error">
<dt>status_on_error</dt><dd><p>(<a class="reference internal" href="../../../../../type/v3/http_status.proto.html#envoy-v3-api-msg-type-v3-httpstatus"><span class="std std-ref">type.v3.HttpStatus</span></a>) Sets the HTTP status that is returned to the client when there is a network error between the
filter and the authorization server. The default status is HTTP 403 Forbidden.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-metadata-context-namespaces">
<dt>metadata_context_namespaces</dt><dd><p>(<strong>repeated</strong> <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) Specifies a list of metadata namespaces whose values, if present, will be passed to the
ext_authz service as an opaque <em>protobuf::Struct</em>.</p>
<p>For example, if the <em>jwt_authn</em> filter is used and <a class="reference internal" href="../../jwt_authn/v3/config.proto.html#envoy-v3-api-field-extensions-filters-http-jwt-authn-v3-jwtprovider-payload-in-metadata"><span class="std std-ref">payload_in_metadata</span></a> is set,
then the following will pass the jwt payload to the authorization server.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">metadata_context_namespaces</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.jwt_authn</span>
</pre></div>
</div>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-filter-enabled">
<dt>filter_enabled</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-runtimefractionalpercent"><span class="std std-ref">config.core.v3.RuntimeFractionalPercent</span></a>) Specifies if the filter is enabled.</p>
<p>If <a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-field-config-core-v3-runtimefractionalpercent-runtime-key"><span class="std std-ref">runtime_key</span></a> is specified,
Envoy will lookup the runtime key to get the percentage of requests to filter.</p>
<p>If this field is not specified, the filter will be enabled for all requests.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-filter-enabled-metadata">
<dt>filter_enabled_metadata</dt><dd><p>(<a class="reference internal" href="../../../../../type/matcher/v3/metadata.proto.html#envoy-v3-api-msg-type-matcher-v3-metadatamatcher"><span class="std std-ref">type.matcher.v3.MetadataMatcher</span></a>) Specifies if the filter is enabled with metadata matcher.
If this field is not specified, the filter will be enabled for all requests.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-deny-at-disable">
<dt>deny_at_disable</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-runtimefeatureflag"><span class="std std-ref">config.core.v3.RuntimeFeatureFlag</span></a>) Specifies whether to deny the requests, when the filter is disabled.
If <a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-field-config-core-v3-runtimefeatureflag-runtime-key"><span class="std std-ref">runtime_key</span></a> is specified,
Envoy will lookup the runtime key to determine whether to deny request for
filter protected path at filter disabling. If filter is disabled in
typed_per_filter_config for the path, requests will not be denied.</p>
<p>If this field is not specified, all requests will be allowed when disabled.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-include-peer-certificate">
<dt>include_peer_certificate</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Specifies if the peer certificate is sent to the external service.</p>
<p>When this field is true, Envoy will include the peer X.509 certificate, if available, in the
<a class="reference internal" href="../../../../../service/auth/v3/attribute_context.proto.html#envoy-v3-api-field-service-auth-v3-attributecontext-peer-certificate"><span class="std std-ref">certificate</span></a>.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-stat-prefix">
<dt>stat_prefix</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) Optional additional prefix to use when emitting statistics. This allows to distinguish
emitted statistics between configured <em>ext_authz</em> filters in an HTTP filter chain. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">http_filters</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.ext_authz</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">waf</span> <span class="c1"># This emits ext_authz.waf.ok, ext_authz.waf.denied, etc.</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.ext_authz</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocker</span> <span class="c1"># This emits ext_authz.blocker.ok, ext_authz.blocker.denied, etc.</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-authz-v3-buffersettings">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-buffersettings"></span><h2>extensions.filters.http.ext_authz.v3.BufferSettings<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-buffersettings" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L144">[extensions.filters.http.ext_authz.v3.BufferSettings proto]</a></p>
<p>Configuration for buffering the request data.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;max_request_bytes&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;allow_partial_message&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;pack_as_bytes&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-buffersettings-max-request-bytes">
<dt>max_request_bytes</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">uint32</a>) Sets the maximum size of a message body that the filter will hold in memory. Envoy will return
<em>HTTP 413</em> and will <em>not</em> initiate the authorization process when buffer reaches the number
set in this field. Note that this setting will have precedence over <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-failure-mode-allow"><span class="std std-ref">failure_mode_allow</span></a>.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-buffersettings-allow-partial-message">
<dt>allow_partial_message</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) When this field is true, Envoy will buffer the message until <em>max_request_bytes</em> is reached.
The authorization request will be dispatched and no 413 HTTP error will be returned by the
filter.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-buffersettings-pack-as-bytes">
<dt>pack_as_bytes</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) If true, the body sent to the external authorization service is set with raw bytes, it sets
the <a class="reference internal" href="../../../../../service/auth/v3/attribute_context.proto.html#envoy-v3-api-field-service-auth-v3-attributecontext-httprequest-raw-body"><span class="std std-ref">raw_body</span></a>
field of HTTP request attribute context. Otherwise, :ref:`
body&lt;envoy_v3_api_field_service.auth.v3.AttributeContext.HttpRequest.body&gt;` will be filled
with UTF-8 string request body.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-authz-v3-httpservice">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-httpservice"></span><h2>extensions.filters.http.ext_authz.v3.HttpService<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-httpservice" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L192">[extensions.filters.http.ext_authz.v3.HttpService proto]</a></p>
<p>HttpService is used for raw HTTP communication between the filter and the authorization service.
When configured, the filter will parse the client request and use these attributes to call the
authorization server. Depending on the response, the filter may reject or accept the client
request. Note that in any of these events, metadata can be added, removed or overridden by the
filter:</p>
<p><em>On authorization request</em>, a list of allowed request headers may be supplied. See
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationrequest-allowed-headers"><span class="std std-ref">allowed_headers</span></a>
for details. Additional headers metadata may be added to the authorization request. See
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationrequest-headers-to-add"><span class="std std-ref">headers_to_add</span></a> for
details.</p>
<p>On authorization response status HTTP 200 OK, the filter will allow traffic to the upstream and
additional headers metadata may be added to the original client request. See
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationresponse-allowed-upstream-headers"><span class="std std-ref">allowed_upstream_headers</span></a>
for details.</p>
<p>On other authorization response statuses, the filter will not allow traffic. Additional headers
metadata as well as body may be added to the client’s response. See <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationresponse-allowed-client-headers"><span class="std std-ref">allowed_client_headers</span></a>
for details.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;server_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorization_request&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorization_response&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-httpservice-server-uri">
<dt>server_uri</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/http_uri.proto.html#envoy-v3-api-msg-config-core-v3-httpuri"><span class="std std-ref">config.core.v3.HttpUri</span></a>) Sets the HTTP server URI which the authorization requests must be sent to.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-httpservice-path-prefix">
<dt>path_prefix</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) Sets a prefix to the value of authorization request header <em>Path</em>.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-httpservice-authorization-request">
<dt>authorization_request</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-authorizationrequest"><span class="std std-ref">extensions.filters.http.ext_authz.v3.AuthorizationRequest</span></a>) Settings used for controlling authorization request metadata.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-httpservice-authorization-response">
<dt>authorization_response</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-authorizationresponse"><span class="std std-ref">extensions.filters.http.ext_authz.v3.AuthorizationResponse</span></a>) Settings used for controlling authorization response metadata.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-authz-v3-authorizationrequest">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-authorizationrequest"></span><h2>extensions.filters.http.ext_authz.v3.AuthorizationRequest<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-authorizationrequest" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L211">[extensions.filters.http.ext_authz.v3.AuthorizationRequest proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;allowed_headers&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;headers_to_add&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationrequest-allowed-headers">
<dt>allowed_headers</dt><dd><p>(<a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">type.matcher.v3.ListStringMatcher</span></a>) Authorization request will include the client request headers that have a correspondent match
in the <a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">list</span></a>. Note that in addition to the
user’s supplied matchers:</p>
<ol class="arabic simple">
<li><p><em>Host</em>, <em>Method</em>, <em>Path</em> and <em>Content-Length</em> are automatically included to the list.</p></li>
</ol>
<p>2. <em>Content-Length</em> will be set to 0 and the request to the authorization service will not have
a message body. However, the authorization request can include the buffered client request body
(controlled by <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-with-request-body"><span class="std std-ref">with_request_body</span></a> setting),
consequently the value of <em>Content-Length</em> of the authorization request reflects the size of
its payload size.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationrequest-headers-to-add">
<dt>headers_to_add</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-headervalue"><span class="std std-ref">config.core.v3.HeaderValue</span></a>) Sets a list of headers that will be included to the request to authorization service. Note that
client request of the same key will be overridden.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-authz-v3-authorizationresponse">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-authorizationresponse"></span><h2>extensions.filters.http.ext_authz.v3.AuthorizationResponse<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-authorizationresponse" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L235">[extensions.filters.http.ext_authz.v3.AuthorizationResponse proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;allowed_upstream_headers&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;allowed_upstream_headers_to_append&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;allowed_client_headers&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationresponse-allowed-upstream-headers">
<dt>allowed_upstream_headers</dt><dd><p>(<a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">type.matcher.v3.ListStringMatcher</span></a>) When this <a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">list</span></a> is set, authorization
response headers that have a correspondent match will be added to the original client request.
Note that coexistent headers will be overridden.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationresponse-allowed-upstream-headers-to-append">
<dt>allowed_upstream_headers_to_append</dt><dd><p>(<a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">type.matcher.v3.ListStringMatcher</span></a>) When this <a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">list</span></a> is set, authorization
response headers that have a correspondent match will be added to the client’s response. Note
that coexistent headers will be appended.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-authorizationresponse-allowed-client-headers">
<dt>allowed_client_headers</dt><dd><p>(<a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">type.matcher.v3.ListStringMatcher</span></a>) When this <a class="reference internal" href="../../../../../type/matcher/v3/string.proto.html#envoy-v3-api-msg-type-matcher-v3-liststringmatcher"><span class="std std-ref">list</span></a>. is set, authorization
response headers that have a correspondent match will be added to the client’s response. Note
that when this list is <em>not</em> set, all the authorization response headers, except <em>Authority
(Host)</em> will be in the response to the client. When a header is included in this list, <em>Path</em>,
<em>Status</em>, <em>Content-Length</em>, <em>WWWAuthenticate</em> and <em>Location</em> are automatically added.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-authz-v3-extauthzperroute">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-extauthzperroute"></span><h2>extensions.filters.http.ext_authz.v3.ExtAuthzPerRoute<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-extauthzperroute" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L258">[extensions.filters.http.ext_authz.v3.ExtAuthzPerRoute proto]</a></p>
<p>Extra settings on a per virtualhost/route/weighted-cluster level.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;disabled&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;check_settings&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthzperroute-disabled">
<dt>disabled</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Disable the ext auth filter for this particular vhost or route.
If disabled is specified in multiple per-filter-configs, the most specific one will be used.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthzperroute-disabled"><span class="std std-ref">disabled</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthzperroute-check-settings"><span class="std std-ref">check_settings</span></a> must be set.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthzperroute-check-settings">
<dt>check_settings</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-checksettings"><span class="std std-ref">extensions.filters.http.ext_authz.v3.CheckSettings</span></a>) Check request settings for this route.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthzperroute-disabled"><span class="std std-ref">disabled</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthzperroute-check-settings"><span class="std std-ref">check_settings</span></a> must be set.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-http-ext-authz-v3-checksettings">
<span id="envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-checksettings"></span><h2>extensions.filters.http.ext_authz.v3.CheckSettings<a class="headerlink" href="#extensions-filters-http-ext-authz-v3-checksettings" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/api/envoy/extensions/filters/http/ext_authz/v3/ext_authz.proto#L275">[extensions.filters.http.ext_authz.v3.CheckSettings proto]</a></p>
<p>Extra settings for the check request.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;context_extensions&quot;</span><span class="p">:</span> <span class="s2">&quot;{...}&quot;</span><span class="p">,</span>
  <span class="nt">&quot;disable_request_body_buffering&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-checksettings-context-extensions">
<dt>context_extensions</dt><dd><p>(<strong>repeated</strong> map&lt;<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>&gt;) Context extensions to set on the CheckRequest’s
<a class="reference internal" href="../../../../../service/auth/v3/attribute_context.proto.html#envoy-v3-api-field-service-auth-v3-attributecontext-context-extensions"><span class="std std-ref">AttributeContext.context_extensions</span></a></p>
<p>You can use this to provide extra context for the external authorization server on specific
virtual hosts/routes. For example, adding a context extension on the virtual host level can
give the ext-authz server information on what virtual host is used without needing to parse the
host header. If CheckSettings is specified in multiple per-filter-configs, they will be merged
in order, and the result will be used.</p>
<p>Merge semantics for this field are such that keys from more specific configs override.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These settings are only applied to a filter configured with a
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-grpc-service"><span class="std std-ref">grpc_service</span></a>.</p>
</div>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-http-ext-authz-v3-checksettings-disable-request-body-buffering">
<dt>disable_request_body_buffering</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) When set to true, disable the configured <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-http-ext-authz-v3-extauthz-with-request-body"><span class="std std-ref">with_request_body</span></a> for a route.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../fault/v3/fault.proto.html" class="btn btn-neutral float-right" title="Fault Injection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../dynamo/v3/dynamo.proto.html" class="btn btn-neutral float-left" title="Dynamo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>