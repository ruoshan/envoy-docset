

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MySQL proxy &mdash; envoy 1.17.0-5c801b documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Postgres proxy" href="postgres_proxy_filter.html" />
    <link rel="prev" title="Mongo proxy" href="mongo_proxy_filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.17.0-5c801b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../listeners.html">Listeners</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats.html">Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="network_filters.html">Network filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="dubbo_proxy_filter.html">Dubbo proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="client_ssl_auth_filter.html">Client TLS authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="echo_filter.html">Echo</a></li>
<li class="toctree-l4"><a class="reference internal" href="direct_response_filter.html">Direct response</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="kafka_broker_filter.html">Kafka Broker filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="mongo_proxy_filter.html">Mongo proxy</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">MySQL proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="postgres_proxy_filter.html">Postgres proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Network Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="redis_proxy_filter.html">Redis proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="rocketmq_proxy_filter.html">RocketMQ proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="tcp_proxy_filter.html">TCP proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrift_proxy_filter.html">Thrift proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="sni_cluster_filter.html">Upstream Cluster from SNI</a></li>
<li class="toctree-l4"><a class="reference internal" href="sni_dynamic_forward_proxy_filter.html">SNI dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm Network Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="zookeeper_proxy_filter.html">ZooKeeper proxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../udp_filters/udp_filters.html">UDP listener filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lds.html">Listener discovery service (LDS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../http/http.html">HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="../listeners.html">Listeners</a> &raquo;</li>
        
          <li><a href="network_filters.html">Network filters</a> &raquo;</li>
        
      <li>MySQL proxy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/configuration/listeners/network_filters/mysql_proxy_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mysql-proxy">
<span id="config-network-filters-mysql-proxy"></span><h1>MySQL proxy<a class="headerlink" href="#mysql-proxy" title="Permalink to this headline">¶</a></h1>
<p>The MySQL proxy filter decodes the wire protocol between the MySQL client
and server. It decodes the SQL queries in the payload (SQL99 format only).
The decoded info is emitted as dynamic metadata that can be combined with
access log filters to get detailed information on tables accessed as well
as operations performed on each table.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The mysql_proxy filter is experimental and is currently under active
development. Capabilities will be expanded over time and the
configuration structures are likely to change.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The mysql_proxy filter was tested with MySQL v5.5. The filter may not work
with other versions of MySQL due to differences in the protocol implementation.</p>
</div>
<div class="section" id="configuration">
<span id="config-network-filters-mysql-proxy-config"></span><h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The MySQL proxy filter should be chained with the TCP proxy filter as shown
in the configuration snippet below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filter_chains</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">filters</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.mysql_proxy</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.mysql_proxy.v3.MySQLProxy</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.tcp_proxy</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
      <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</div>
<div class="section" id="statistics">
<span id="config-network-filters-mysql-proxy-stats"></span><h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>Every configured MySQL proxy filter has statistics rooted at <em>mysql.&lt;stat_prefix&gt;.</em> with the
following statistics:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>auth_switch_request</p></td>
<td><p>Counter</p></td>
<td><p>Number of times the upstream server requested clients to switch to a different authentication method</p></td>
</tr>
<tr class="row-odd"><td><p>decoder_errors</p></td>
<td><p>Counter</p></td>
<td><p>Number of MySQL protocol decoding errors</p></td>
</tr>
<tr class="row-even"><td><p>login_attempts</p></td>
<td><p>Counter</p></td>
<td><p>Number of login attempts</p></td>
</tr>
<tr class="row-odd"><td><p>login_failures</p></td>
<td><p>Counter</p></td>
<td><p>Number of login failures</p></td>
</tr>
<tr class="row-even"><td><p>protocol_errors</p></td>
<td><p>Counter</p></td>
<td><p>Number of out of sequence protocol messages encountered in a session</p></td>
</tr>
<tr class="row-odd"><td><p>queries_parse_error</p></td>
<td><p>Counter</p></td>
<td><p>Number of MySQL queries parsed with errors</p></td>
</tr>
<tr class="row-even"><td><p>queries_parsed</p></td>
<td><p>Counter</p></td>
<td><p>Number of MySQL queries successfully parsed</p></td>
</tr>
<tr class="row-odd"><td><p>sessions</p></td>
<td><p>Counter</p></td>
<td><p>Number of MySQL sessions since start</p></td>
</tr>
<tr class="row-even"><td><p>upgraded_to_ssl</p></td>
<td><p>Counter</p></td>
<td><p>Number of sessions/connections that were upgraded to SSL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dynamic-metadata">
<span id="config-network-filters-mysql-proxy-dynamic-metadata"></span><h2>Dynamic Metadata<a class="headerlink" href="#dynamic-metadata" title="Permalink to this headline">¶</a></h2>
<p>The MySQL filter emits the following dynamic metadata for each SQL query parsed:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>&lt;table.db&gt;</p></td>
<td><p>string</p></td>
<td><p>The resource name in <em>table.db</em> format. The resource name defaults to the table being accessed if the database cannot be inferred.</p></td>
</tr>
<tr class="row-odd"><td><p>[]</p></td>
<td><p>list</p></td>
<td><p>A list of strings representing the operations executed on the resource. Operations can be one of insert/update/select/drop/delete/create/alter/show.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rbac-enforcement-on-table-accesses">
<span id="config-network-filters-mysql-proxy-rbac"></span><h2>RBAC Enforcement on Table Accesses<a class="headerlink" href="#rbac-enforcement-on-table-accesses" title="Permalink to this headline">¶</a></h2>
<p>The dynamic metadata emitted by the MySQL filter can be used in conjunction
with the RBAC filter to control accesses to individual tables in a
database. The following configuration snippet shows an example RBAC filter
configuration that denies SQL queries with _update_ statements to the
_catalog_ table in the _productdb_ database.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filter_chains</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">filters</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.mysql_proxy</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.mysql_proxy.v3.MySQLProxy</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.rbac</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.rbac.v3.RBAC</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac</span>
      <span class="nt">rules</span><span class="p">:</span>
        <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DENY</span>
        <span class="nt">policies</span><span class="p">:</span>
          <span class="s">&quot;product-viewer&quot;</span><span class="p p-Indicator">:</span>
            <span class="nt">permissions</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">metadata</span><span class="p">:</span>
                <span class="nt">filter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.mysql_proxy</span>
                <span class="nt">path</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">catalog.productdb</span>
                <span class="nt">value</span><span class="p">:</span>
                  <span class="nt">list_match</span><span class="p">:</span>
                    <span class="nt">one_of</span><span class="p">:</span>
                      <span class="nt">string_match</span><span class="p">:</span>
                        <span class="nt">exact</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update</span>
            <span class="nt">principals</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">any</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.tcp_proxy</span>
    <span class="nt">typed_config</span><span class="p">:</span>
      <span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy</span>
      <span class="nt">stat_prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
      <span class="nt">cluster</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="postgres_proxy_filter.html" class="btn btn-neutral float-right" title="Postgres proxy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mongo_proxy_filter.html" class="btn btn-neutral float-left" title="Mongo proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>