

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RocketMQ proxy &mdash; envoy 1.17.0-5c801b documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TCP proxy" href="tcp_proxy_filter.html" />
    <link rel="prev" title="Redis proxy" href="redis_proxy_filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.17.0-5c801b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../listeners.html">Listeners</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats.html">Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="network_filters.html">Network filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="dubbo_proxy_filter.html">Dubbo proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="client_ssl_auth_filter.html">Client TLS authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="echo_filter.html">Echo</a></li>
<li class="toctree-l4"><a class="reference internal" href="direct_response_filter.html">Direct response</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="kafka_broker_filter.html">Kafka Broker filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="mongo_proxy_filter.html">Mongo proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="mysql_proxy_filter.html">MySQL proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="postgres_proxy_filter.html">Postgres proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Network Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="redis_proxy_filter.html">Redis proxy</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">RocketMQ proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="tcp_proxy_filter.html">TCP proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrift_proxy_filter.html">Thrift proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="sni_cluster_filter.html">Upstream Cluster from SNI</a></li>
<li class="toctree-l4"><a class="reference internal" href="sni_dynamic_forward_proxy_filter.html">SNI dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm Network Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="zookeeper_proxy_filter.html">ZooKeeper proxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../udp_filters/udp_filters.html">UDP listener filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lds.html">Listener discovery service (LDS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../http/http.html">HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="../listeners.html">Listeners</a> &raquo;</li>
        
          <li><a href="network_filters.html">Network filters</a> &raquo;</li>
        
      <li>RocketMQ proxy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/configuration/listeners/network_filters/rocketmq_proxy_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rocketmq-proxy">
<span id="config-network-filters-rocketmq-proxy"></span><h1>RocketMQ proxy<a class="headerlink" href="#rocketmq-proxy" title="Permalink to this headline">¶</a></h1>
<p>Apache RocketMQ is a distributed messaging system, which is composed of four types of roles: producer, consumer, name
server and broker server. The former two are embedded into user application in form of SDK; whilst the latter are
standalone servers.</p>
<p>A message in RocketMQ carries a topic as its destination and optionally one or more tags as application specific labels.</p>
<p>Producers are used to send messages to brokers according to their topics. Similar to many distributed systems,
producers need to know how to connect to these serving brokers. To achieve this goal, RocketMQ provides name server
clusters for producers to lookup. Namely, when producers attempts to send messages with a new topic, it first
tries to lookup the addresses(called route info) of brokers that serve the topic from name servers. Once producers
get the route info of the topic, they actively cache them in memory and renew them periodically thereafter. This
mechanism, though simple, effectively keeps service availability high without demanding availability of name server
service.</p>
<p>Brokers provides messaging service to end users. In addition to various messaging services, they also periodically
report health status and route info of topics currently served to name servers.</p>
<p>Major role of the name server is to serve querying of route info  for a topic. Additionally, it also purges route info
entries once the belonging brokers fail to report their health info for a configured period of time. This ensures
clients almost always connect to brokers that are online and ready to serve.</p>
<p>Consumers are used by application to pull message from brokers. They perform similar heartbeats to maintain alive
status. RocketMQ brokers support two message-fetch approaches: long-pulling and pop.</p>
<p>Using the first approach, consumers have to implement load-balancing algorithm. The pop approach, in the perspective of
consumers, is stateless.</p>
<p>Envoy RocketMQ filter proxies requests and responses between producers/consumer and brokers. Various statistical items
are collected to enhance observability.</p>
<p>At present, pop-based message fetching is implemented. Long-pulling will be implemented in the next pull request.</p>
<div class="section" id="statistics">
<span id="config-network-filters-rocketmq-proxy-stats"></span><h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>Every configured rocketmq proxy filter has statistics rooted at <em>rocketmq.&lt;stat_prefix&gt;.</em> with the
following statistics:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>request</p></td>
<td><p>Counter</p></td>
<td><p>Total requests</p></td>
</tr>
<tr class="row-odd"><td><p>request_decoding_error</p></td>
<td><p>Counter</p></td>
<td><p>Total decoding error requests</p></td>
</tr>
<tr class="row-even"><td><p>request_decoding_success</p></td>
<td><p>Counter</p></td>
<td><p>Total decoding success requests</p></td>
</tr>
<tr class="row-odd"><td><p>response</p></td>
<td><p>Counter</p></td>
<td><p>Total responses</p></td>
</tr>
<tr class="row-even"><td><p>response_decoding_error</p></td>
<td><p>Counter</p></td>
<td><p>Total decoding error responses</p></td>
</tr>
<tr class="row-odd"><td><p>response_decoding_success</p></td>
<td><p>Counter</p></td>
<td><p>Total decoding success responses</p></td>
</tr>
<tr class="row-even"><td><p>response_error</p></td>
<td><p>Counter</p></td>
<td><p>Total error responses</p></td>
</tr>
<tr class="row-odd"><td><p>response_success</p></td>
<td><p>Counter</p></td>
<td><p>Total success responses</p></td>
</tr>
<tr class="row-even"><td><p>heartbeat</p></td>
<td><p>Counter</p></td>
<td><p>Total heartbeat requests</p></td>
</tr>
<tr class="row-odd"><td><p>unregister</p></td>
<td><p>Counter</p></td>
<td><p>Total unregister requests</p></td>
</tr>
<tr class="row-even"><td><p>get_topic_route</p></td>
<td><p>Counter</p></td>
<td><p>Total getting topic route requests</p></td>
</tr>
<tr class="row-odd"><td><p>send_message_v1</p></td>
<td><p>Counter</p></td>
<td><p>Total sending message v1 requests</p></td>
</tr>
<tr class="row-even"><td><p>send_message_v2</p></td>
<td><p>Counter</p></td>
<td><p>Total sending message v2 requests</p></td>
</tr>
<tr class="row-odd"><td><p>pop_message</p></td>
<td><p>Counter</p></td>
<td><p>Total poping message requests</p></td>
</tr>
<tr class="row-even"><td><p>ack_message</p></td>
<td><p>Counter</p></td>
<td><p>Total acking message requests</p></td>
</tr>
<tr class="row-odd"><td><p>get_consumer_list</p></td>
<td><p>Counter</p></td>
<td><p>Total getting consumer list requests</p></td>
</tr>
<tr class="row-even"><td><p>maintenance_failure</p></td>
<td><p>Counter</p></td>
<td><p>Total maintenance failure</p></td>
</tr>
<tr class="row-odd"><td><p>request_active</p></td>
<td><p>Gauge</p></td>
<td><p>Total active requests</p></td>
</tr>
<tr class="row-even"><td><p>send_message_v1_active</p></td>
<td><p>Gauge</p></td>
<td><p>Total active sending message v1 requests</p></td>
</tr>
<tr class="row-odd"><td><p>send_message_v2_active</p></td>
<td><p>Gauge</p></td>
<td><p>Total active sending message v2 requests</p></td>
</tr>
<tr class="row-even"><td><p>pop_message_active</p></td>
<td><p>Gauge</p></td>
<td><p>Total active poping message active requests</p></td>
</tr>
<tr class="row-odd"><td><p>get_topic_route_active</p></td>
<td><p>Gauge</p></td>
<td><p>Total active geting topic route requests</p></td>
</tr>
<tr class="row-even"><td><p>send_message_pending</p></td>
<td><p>Gauge</p></td>
<td><p>Total pending sending message requests</p></td>
</tr>
<tr class="row-odd"><td><p>pop_message_pending</p></td>
<td><p>Gauge</p></td>
<td><p>Total pending poping message requests</p></td>
</tr>
<tr class="row-even"><td><p>get_topic_route_pending</p></td>
<td><p>Gauge</p></td>
<td><p>Total pending geting topic route requests</p></td>
</tr>
<tr class="row-odd"><td><p>total_pending</p></td>
<td><p>Gauge</p></td>
<td><p>Total pending requests</p></td>
</tr>
<tr class="row-even"><td><p>request_time_ms</p></td>
<td><p>Histogram</p></td>
<td><p>Request time in milliseconds</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tcp_proxy_filter.html" class="btn btn-neutral float-right" title="TCP proxy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="redis_proxy_filter.html" class="btn btn-neutral float-left" title="Redis proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>