

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Google Vulnerability Reward Program (VRP) &mdash; envoy 1.17.0-5c801b documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Operations &amp; configuration" href="../operations/operations.html" />
    <link rel="prev" title="External dependencies" href="external_deps.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.17.0-5c801b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../intro.html">Introduction</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../what_is_envoy.html">What is Envoy</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../arch_overview.html">Architecture overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../intro/intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../listeners/listeners_toc.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html">HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability.html">Observability</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="security.html">Security</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ssl.html">TLS</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JSON Web Token (JWT) Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="threat_model.html">Threat model</a></li>
<li class="toctree-l4"><a class="reference internal" href="external_deps.html">External dependencies</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Google Vulnerability Reward Program (VRP)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../operations/operations.html">Operations &amp; configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../other_features/other_features.html">Other features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/advanced.html">Advanced</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../life_of_a_request.html">Life of a Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../deployment_types/deployment_types.html">Deployment types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_help.html">Getting help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../intro.html">Introduction</a> &raquo;</li>
        
          <li><a href="../arch_overview.html">Architecture overview</a> &raquo;</li>
        
          <li><a href="security.html">Security</a> &raquo;</li>
        
      <li>Google Vulnerability Reward Program (VRP)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/intro/arch_overview/security/google_vrp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="google-vulnerability-reward-program-vrp">
<span id="arch-overview-google-vrp"></span><h1>Google Vulnerability Reward Program (VRP)<a class="headerlink" href="#google-vulnerability-reward-program-vrp" title="Permalink to this headline">¶</a></h1>
<p>Envoy is a participant in <a class="reference external" href="https://www.google.com/about/appsecurity/reward-program/">Google’s Vulnerability Reward Program (VRP)</a>. This is open to all security
researchers and will provide rewards for vulnerabilities discovered and reported according to the
rules below.</p>
<div class="section" id="rules">
<span id="arch-overview-google-vrp-rules"></span><h2>Rules<a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h2>
<p>The goal of the VRP is to provide a formal process to honor contributions from external
security researchers to Envoy’s security. Vulnerabilities should meet the following conditions
to be eligible for the program:</p>
<ol class="arabic simple">
<li><p>Vulnerabilities must meet one of the below <a class="reference internal" href="#arch-overview-google-vrp-objectives"><span class="std std-ref">objectives</span></a>, demonstrated with the supplied Docker-based
<a class="reference internal" href="#arch-overview-google-vrp-ee"><span class="std std-ref">execution environment</span></a> and be consistent with the
program’s <a class="reference internal" href="#arch-overview-google-vrp-threat-model"><span class="std std-ref">threat model</span></a>.</p></li>
<li><p>Vulnerabilities must be reported to <a class="reference external" href="mailto:envoy-security&#37;&#52;&#48;googlegroups&#46;com">envoy-security<span>&#64;</span>googlegroups<span>&#46;</span>com</a> and be kept under embargo
while triage and potential security releases occur. Please follow the <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/SECURITY.md#disclosures">disclosure guidance</a> when submitting reports. Disclosure SLOs are documented <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/SECURITY.md#fix-and-disclosure-slos">here</a>. In general, security disclosures are subject to the
<a class="reference external" href="https://www.linuxfoundation.org/privacy/">Linux Foundation’s privacy policy</a> with the added
proviso that VRP reports (including reporter e-mail address and name) may be freely shared with
Google for VRP purposes.</p></li>
<li><p>Vulnerabilities must not be previously known in a public forum, e.g. GitHub issues trackers,
CVE databases (when previously associated with Envoy), etc. Existing CVEs that have not been
previously associated with an Envoy vulnerability are fair game.</p></li>
<li><p>Vulnerabilities must not be also submitted to a parallel reward program run by Google or
<a class="reference external" href="https://www.lyft.com/security">Lyft</a>.</p></li>
</ol>
<p>Rewards are at the discretion of the Envoy OSS security team and Google. They will be conditioned on
the above criteria. If multiple instances of the same vulnerability are reported at the same time by
independent researchers or the vulnerability is already tracked under embargo by the OSS Envoy
security team, we will aim to fairly divide the reward amongst reporters.</p>
</div>
<div class="section" id="threat-model">
<span id="arch-overview-google-vrp-threat-model"></span><h2>Threat model<a class="headerlink" href="#threat-model" title="Permalink to this headline">¶</a></h2>
<p>The base threat model matches that of Envoy’s <a class="reference internal" href="threat_model.html#arch-overview-threat-model"><span class="std std-ref">OSS security posture</span></a>. We add a number of temporary restrictions to provide a constrained
attack surface for the initial stages of this program. We exclude any threat from:</p>
<ul class="simple">
<li><p>Untrusted control planes.</p></li>
<li><p>Runtime services such as access logging, external authorization, etc.</p></li>
<li><p>Untrusted upstreams.</p></li>
<li><p>DoS attacks except as stipulated below.</p></li>
<li><p>Any filters apart from the HTTP connection manager network filter and HTTP router filter.</p></li>
<li><p>Admin console; this is disabled in the execution environment.</p></li>
</ul>
<p>We also explicitly exclude any local attacks (e.g. via local processes, shells, etc.) against
the Envoy process. All attacks must occur via the network data plane on port 10000. Similarly,
kernel and Docker vulnerabilities are outside the threat model.</p>
<p>In the future we may relax some of these restrictions as we increase the sophistication of the
program’s execution environment.</p>
</div>
<div class="section" id="execution-environment">
<span id="arch-overview-google-vrp-ee"></span><h2>Execution environment<a class="headerlink" href="#execution-environment" title="Permalink to this headline">¶</a></h2>
<p>We supply Docker images that act as the reference environment for this program:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://hub.docker.com/r/envoyproxy/envoy-google-vrp/tags/">envoyproxy/envoy-google-vrp</a> images
are based on Envoy point releases. Only the latest point release at the time of vulnerability
submission is eligible for the program. The first point release available for VRP will be the
1.15.0 Envoy release.</p></li>
<li><p><a class="reference external" href="https://hub.docker.com/r/envoyproxy/envoy-google-vrp-dev/tags/">envoyproxy/envoy-google-vrp-dev</a>
images are based on Envoy master builds. Only builds within the last 5 days at the time of
vulnerability submission are eligible for the program. They must not be subject to any
publicly disclosed vulnerability at that point in time.</p></li>
</ul>
<p>Two Envoy processes are available when these images are launched via <cite>docker run</cite>:</p>
<ul class="simple">
<li><p>The <em>edge</em> Envoy is listening on ports 10000 (HTTPS). It has a <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283//configs/google-vrp/envoy-edge.yaml">static configuration</a> that is configured according to Envoy’s <a class="reference internal" href="../../../faq/configuration/edge.html#faq-edge"><span class="std std-ref">edge hardening
principles</span></a>. It has sinkhole, direct response and request forwarding routing rules (in
order):</p>
<ol class="arabic simple">
<li><p><cite>/content/*</cite>: route to the origin Envoy server.</p></li>
<li><p><cite>/*</cite>: return 403 (denied).</p></li>
</ol>
</li>
<li><p>The <em>origin</em> Envoy is an upstream of the edge Envoy. It has a <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283//configs/google-vrp/envoy-origin.yaml">static configuration</a> that features only direct responses, effectively acting
as an HTTP origin server. There are two route rules (in order):</p>
<ol class="arabic simple">
<li><p><cite>/blockedz</cite>: return 200 <cite>hidden treasure</cite>. It should never be possible to have
traffic on the Envoy edge server’s 10000 port receive this response unless a
qualifying vulnerability is present.</p></li>
<li><p><cite>/*</cite>: return 200 <cite>normal</cite>.</p></li>
</ol>
</li>
</ul>
<p>When running the Docker images, the following command line options should be supplied:</p>
<ul class="simple">
<li><p><cite>-m 3g</cite> to ensure that memory is bounded to 3GB. At least this much memory should be available
to the execution environment. Each Envoy process has an overload manager configured to limit
at 1GB.</p></li>
<li><p><cite>-e ENVOY_EDGE_EXTRA_ARGS=”&lt;…&gt;”</cite> supplies additional CLI args for the edge Envoy. This
needs to be set but can be empty.</p></li>
<li><p><cite>-e ENVOY_ORIGIN_EXTRA_ARGS=”&lt;…&gt;”</cite> supplies additional CLI args for the origin Envoy. This
needs to be set but can be empty.</p></li>
</ul>
</div>
<div class="section" id="objectives">
<span id="arch-overview-google-vrp-objectives"></span><h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<p>Vulnerabilities will be evidenced by requests on 10000 that trigger a failure mode
that falls into one of these categories:</p>
<ul class="simple">
<li><p>Query-of-death: requests that cause the Envoy process to segfault or abort
in some immediate way.</p></li>
<li><p>OOM: requests that cause the edge Envoy process to OOM. There should be no more than
100 connections and streams in total involved to cause this to happen (i.e. brute force
connection/stream DoS is excluded).</p></li>
<li><p>Routing rule bypass: requests that are able to access <cite>hidden treasure</cite>.</p></li>
<li><p>TLS certificate exfiltration: requests that are able to obtain the edge Envoy’s
<cite>serverkey.pem</cite>.</p></li>
<li><p>Remote code exploits: any root shell obtained via the network data plane.</p></li>
<li><p>At the discretion of the OSS Envoy security team, sufficiently interesting vulnerabilities that
don’t fit the above categories but are likely to fall into the category of high or critical
vulnerabilities.</p></li>
</ul>
</div>
<div class="section" id="working-with-the-docker-images">
<h2>Working with the Docker images<a class="headerlink" href="#working-with-the-docker-images" title="Permalink to this headline">¶</a></h2>
<p>A basic invocation of the execution environment that will bring up the edge Envoy on local
port 10000 looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -m 3g -p <span class="m">10000</span>:10000 --name envoy-google-vrp <span class="se">\</span>
  -e <span class="nv">ENVOY_EDGE_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="se">\</span>
  -e <span class="nv">ENVOY_ORIGIN_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="se">\</span>
  envoyproxy/envoy-google-vrp-dev:latest
</pre></div>
</div>
<p>When debugging, additional args may prove useful, e.g. in order to obtain trace logs, make
use of <cite>wireshark</cite> and <cite>gdb</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -m 3g -p <span class="m">10000</span>:10000 --name envoy-google-vrp <span class="se">\</span>
  -e <span class="nv">ENVOY_EDGE_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;-l trace&quot;</span> <span class="se">\</span>
  -e <span class="nv">ENVOY_ORIGIN_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;-l trace&quot;</span> <span class="se">\</span>
  --cap-add SYS_PTRACE --cap-add NET_RAW --cap-add NET_ADMIN <span class="se">\</span>
  envoyproxy/envoy-google-vrp-dev:latest
</pre></div>
</div>
<p>You can obtain a shell in the Docker container with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it envoy-google-vrp /bin/bash
</pre></div>
</div>
<p>The Docker images include <cite>gdb</cite>, <cite>strace</cite>, <cite>tshark</cite> (feel free to contribute other
suggestions via PRs updating the <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283//ci/Dockerfile-envoy-google-vrp">Docker build file</a>).</p>
</div>
<div class="section" id="rebuilding-the-docker-image">
<h2>Rebuilding the Docker image<a class="headerlink" href="#rebuilding-the-docker-image" title="Permalink to this headline">¶</a></h2>
<p>It’s helpful to be able to regenerate your own Docker base image for research purposes.
To do this without relying on CI, follow the instructions at the top of
<a class="reference external" href="https://github.com/envoyproxy/envoy/blob/5c801b25cae04f06bf48248c90e87d623d7a6283/ci/docker_rebuild_google-vrp.sh">ci/docker_rebuild_google-vrp.sh</a>. An example of this flow looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bazel build //source/exe:envoy-static
./ci/docker_rebuild_google-vrp.sh bazel-bin/source/exe/envoy-static
docker run -m 3g -p <span class="m">10000</span>:10000 --name envoy-google-vrp <span class="se">\</span>
  -e <span class="nv">ENVOY_EDGE_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="se">\</span>
  -e <span class="nv">ENVOY_ORIGIN_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="se">\</span>
  envoy-google-vrp:local
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operations/operations.html" class="btn btn-neutral float-right" title="Operations &amp; configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="external_deps.html" class="btn btn-neutral float-left" title="External dependencies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>