

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CORS Filter &mdash; envoy tag-v1.9.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Front Proxy" href="front_proxy.html" />
    <link rel="prev" title="Getting Started" href="../start.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../start.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../start.html#quick-start-to-run-simple-example">Quick Start to Run Simple Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#simple-configuration">Simple Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#using-the-envoy-docker-image">Using the Envoy Docker Image</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../start.html#sandboxes">Sandboxes</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">CORS Filter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-the-sandboxes">Running the Sandboxes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="front_proxy.html">Front Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="zipkin_tracing.html">Zipkin Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="jaeger_tracing.html">Jaeger Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="jaeger_native_tracing.html">Jaeger Native Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc_bridge.html">gRPC Bridge</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/envoyproxy/envoy/tree/master/examples/lua">Lua</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/envoyproxy/envoy/tree/master/examples/fault-injection">Fault Injection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#other-use-cases">Other use cases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../start.html">Getting Started</a> &raquo;</li>
        
      <li>CORS Filter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/start/sandboxes/cors.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cors-filter">
<span id="install-sandboxes-cors"></span><h1>CORS Filter<a class="headerlink" href="#cors-filter" title="Permalink to this headline">¶</a></h1>
<p>Cross-Origin Resource Sharing (CORS) is a method of enforcing client-side
access controls on resources by specifying external domains that are able to
access certain or all routes of your domain. Browsers use the presence of HTTP
headers to determine if a response from a different origin is allowed.</p>
<p>To help demonstrate how front-envoy can enforce CORS policies, we are
releasing a set of <a class="reference external" href="http://docs.docker.com/compose/">docker compose</a> sandboxes
that deploy a frontend and backend service on different origins, both behind
front-envoy.</p>
<p>The frontend service has a field to input the remote domain of your backend
service along with radio buttons to select the remote domain’s CORS enforcement.
The CORS enforcement choices are:</p>
<blockquote>
<div><ul class="simple">
<li>Disabled: CORS is disabled on the route requested. This will result in a
client-side CORS error since the required headers to be considered a
valid CORS request are not present.</li>
<li>Open: CORS is enabled on the route requested but the allowed origin is set
to <code class="docutils literal notranslate"><span class="pre">*</span></code>. This is a very permissive policy and means that origin can request
data from this endpoint.</li>
<li>Restricted: CORS is enabled on the route requested and the only allowed
origin is <code class="docutils literal notranslate"><span class="pre">envoyproxy.io</span></code>. This will result in a client-side CORS error.</li>
</ul>
</div></blockquote>
<div class="section" id="running-the-sandboxes">
<h2>Running the Sandboxes<a class="headerlink" href="#running-the-sandboxes" title="Permalink to this headline">¶</a></h2>
<p>The following documentation runs through the setup of both services.</p>
<p><strong>Step 1: Install Docker</strong></p>
<p>Ensure that you have a recent versions of <code class="docutils literal notranslate"><span class="pre">docker</span></code>, <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> and
<code class="docutils literal notranslate"><span class="pre">docker-machine</span></code> installed.</p>
<p>A simple way to achieve this is via the <a class="reference external" href="https://www.docker.com/products/docker-toolbox">Docker Toolbox</a>.</p>
<p><strong>Step 2: Setup Docker Machines</strong></p>
<p>First, let’s create a couple of new machines which will hold the containers.</p>
<p>Terminal 1</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker-machine create --driver virtualbox frontend
<span class="gp">$</span> <span class="nb">eval</span> <span class="k">$(</span>docker-machine env frontend<span class="k">)</span>
</pre></div>
</div>
<p>Terminal 2</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker-machine create --driver virtualbox backend
<span class="gp">$</span> <span class="nb">eval</span> <span class="k">$(</span>docker-machine env backend<span class="k">)</span>
</pre></div>
</div>
<p><strong>Step 3: Clone the Envoy repo and start all of our containers</strong></p>
<p>If you have not cloned the Envoy repo, clone it with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:envoyproxy/envoy</span></code>
or <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/envoyproxy/envoy.git</span></code></p>
<p>Terminal 1</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">pwd</span>
<span class="go">envoy/examples/cors/frontend</span>
<span class="gp">$</span> docker-compose up --build -d
<span class="gp">$</span> docker-compose ps
<span class="go">        Name                                  Command                    State                  Ports</span>
<span class="go">-----------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="go">frontend_front-envoy_1_cb51c62edc96        /usr/bin/dumb-init -- /bin ... Up      10000/tcp, 0.0.0.0:8000-&gt;80/tcp, 0.0.0.0:8001-&gt;8001/tcp</span>
<span class="go">frontend_frontend-service_1_491cf87432cd   /bin/sh -c /usr/local/bin/ ... Up      10000/tcp, 80/tcp</span>
</pre></div>
</div>
<p>Terminal 2</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">pwd</span>
<span class="go">envoy/examples/cors/backend</span>
<span class="gp">$</span> docker-compose up --build -d
<span class="gp">$</span> docker-compose ps
<span class="go">        Name                                  Command                    State                  Ports</span>
<span class="go">-----------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="go">backend_front-envoy_1_7f9d5039c86f       /usr/bin/dumb-init -- /bin ... Up      10000/tcp, 0.0.0.0:8000-&gt;80/tcp, 0.0.0.0:8001-&gt;8001/tcp</span>
<span class="go">backend_backend-service_1_c7752ae7192a   /bin/sh -c /usr/local/bin/ ... Up      10000/tcp, 80/tcp</span>
</pre></div>
</div>
<p><strong>Step 4: Test Envoy’s CORS capabilities</strong></p>
<p>You can now open a browser to view your frontend service. To find the IP of
your frontend service run the following command in terminal 1.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker-machine ip frontend
</pre></div>
</div>
<p>In terminal 2, run the same command to get the remote origin IP that the
frontend service will be making requests to.</p>
<p>Results of the cross-origin request will be shown on the page under <em>Request Results</em>.
Your browser’s CORS enforcement logs can be found in the console.</p>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Access to XMLHttpRequest at &#39;http://192.168.99.100:8000/cors/disabled&#39; from origin &#39;http://192.168.99.101:8000&#39;</span>
<span class="go">has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.</span>
</pre></div>
</div>
<p><strong>Step 6: Check stats of backend via admin</strong></p>
<p>When Envoy runs, it can listen to <code class="docutils literal notranslate"><span class="pre">admin</span></code> requests if a port is configured. In the example
configs, the admin is bound to port <code class="docutils literal notranslate"><span class="pre">8001</span></code>.</p>
<p>If you go to <code class="docutils literal notranslate"><span class="pre">&lt;backend_service_ip&gt;:8001/stats</span></code> you will be able to view
all of the Envoy stats for the backend. You should see the CORS stats for
invalid and valid origins increment as you make requests from the frontend cluster.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http.ingress_http.cors.origin_invalid: 0
http.ingress_http.cors.origin_valid: 0
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="front_proxy.html" class="btn btn-neutral float-right" title="Front Proxy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../start.html" class="btn btn-neutral" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>