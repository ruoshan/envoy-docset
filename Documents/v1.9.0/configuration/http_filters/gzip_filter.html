

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Gzip &mdash; envoy tag-v1.9.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Health check" href="health_check_filter.html" />
    <link rel="prev" title="gRPC-Web" href="grpc_web_filter.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/v2_overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_filters/network_filters.html">Network filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Gzip</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime">Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l3"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l3"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l3"><a class="reference internal" href="squash_filter.html">Squash</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../thrift_filters/thrift_filters.html">Thrift filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_manager/cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../health_checkers/health_checkers.html">Health checkers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access_log.html">Access logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limit.html">Rate limit service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statistics.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/router_check.html">Route table check tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overload_manager/overload_manager.html">Overload manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secret.html">Secret discovery service (SDS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../well_known_dynamic_metadata.html">Well Known Dynamic Metadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="http_filters.html">HTTP filters</a> &raquo;</li>
        
      <li>Gzip</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/configuration/http_filters/gzip_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gzip">
<span id="config-http-filters-gzip"></span><h1>Gzip<a class="headerlink" href="#gzip" title="Permalink to this headline">¶</a></h1>
<p>Gzip is an HTTP filter which enables Envoy to compress dispatched data
from an upstream service upon client request. Compression is useful in
situations where large payloads need to be transmitted without
compromising the response time.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../../api-v2/config/filter/http/gzip/v2/gzip.proto.html#envoy-api-msg-config-filter-http-gzip-v2-gzip"><span class="std std-ref">v2 API reference</span></a></li>
<li>This filter should be configured with the name <em>envoy.gzip</em>.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The <em>window bits</em> is a number that tells the compressor how far ahead in the
text the algorithm should be looking for repeated sequence of characters.
Due to a known bug in the underlying zlib library, <em>window bits</em> with value
eight does not work as expected. Therefore any number below that will be
automatically set to 9. This issue might be solved in future releases of
the library.</p>
</div>
</div>
<div class="section" id="runtime">
<h2>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h2>
<p>The Gzip filter supports the following runtime settings:</p>
<dl class="docutils">
<dt>gzip.filter_enabled</dt>
<dd>The % of requests for which the filter is enabled. Default is 100.</dd>
</dl>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>When gzip filter is enabled, request and response headers are inspected to
determine whether or not the content should be compressed. The content is
compressed and then sent to the client with the appropriate headers if either
response and request allow.</p>
<p>By <em>default</em> compression will be <em>skipped</em> when:</p>
<ul class="simple">
<li>A request does NOT contain <em>accept-encoding</em> header.</li>
<li>A request includes <em>accept-encoding</em> header, but it does not contain “gzip” or “*”.</li>
<li>A request includes <em>accept-encoding</em> with “gzip” or “*” with the weight “q=0”. Note
that the “gzip” will have a higher weight then “*”. For example, if <em>accept-encoding</em>
is “gzip;q=0,*;q=1”, the filter will not compress. But if the header is set to
“*;q=0,gzip;q=1”, the filter will compress.</li>
<li>A request whose <em>accept-encoding</em> header includes “identity”.</li>
<li>A response contains a <em>content-encoding</em> header.</li>
<li>A response contains a <em>cache-control</em> header whose value includes “no-transform”.</li>
<li>A response contains a <em>transfer-encoding</em> header whose value includes “gzip”.</li>
<li>A response does not contain a <em>content-type</em> value that matches one of the selected
mime-types, which default to <em>application/javascript</em>, <em>application/json</em>,
<em>application/xhtml+xml</em>, <em>image/svg+xml</em>, <em>text/css</em>, <em>text/html</em>, <em>text/plain</em>,
<em>text/xml</em>.</li>
<li>Neither <em>content-length</em> nor <em>transfer-encoding</em> headers are present in
the response.</li>
<li>Response size is smaller than 30 bytes (only applicable when <em>transfer-encoding</em>
is not chuncked).</li>
</ul>
<p>When compression is <em>applied</em>:</p>
<ul class="simple">
<li>The <em>content-length</em> is removed from response headers.</li>
<li>Response headers contain “<em>transfer-encoding: chunked</em>” and
“<em>content-encoding: gzip</em>”.</li>
<li>The “<em>vary: accept-encoding</em>” header is inserted on every response.</li>
</ul>
</div>
<div class="section" id="statistics">
<span id="gzip-statistics"></span><h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>Every configured Gzip filter has statistics rooted at &lt;stat_prefix&gt;.gzip.* with the following:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>compressed</td>
<td>Counter</td>
<td>Number of requests compressed.</td>
</tr>
<tr class="row-odd"><td>not_compressed</td>
<td>Counter</td>
<td>Number of requests not compressed.</td>
</tr>
<tr class="row-even"><td>no_accept_header</td>
<td>Counter</td>
<td>Number of requests with no accept header sent.</td>
</tr>
<tr class="row-odd"><td>header_identity</td>
<td>Counter</td>
<td>Number of requests sent with “identity” set as the <em>accept-encoding</em>.</td>
</tr>
<tr class="row-even"><td>header_gzip</td>
<td>Counter</td>
<td>Number of requests sent with “gzip” set as the <em>accept-encoding</em>.</td>
</tr>
<tr class="row-odd"><td>header_wildcard</td>
<td>Counter</td>
<td>Number of requests sent with “*” set as the <em>accept-encoding</em>.</td>
</tr>
<tr class="row-even"><td>header_not_valid</td>
<td>Counter</td>
<td>Number of requests sent with a not valid <em>accept-encoding</em> header (aka “q=0” or an unsupported encoding type).</td>
</tr>
<tr class="row-odd"><td>total_uncompressed_bytes</td>
<td>Counter</td>
<td>The total uncompressed bytes of all the requests that were marked for compression.</td>
</tr>
<tr class="row-even"><td>total_compressed_bytes</td>
<td>Counter</td>
<td>The total compressed bytes of all the requests that were marked for compression.</td>
</tr>
<tr class="row-odd"><td>content_length_too_small</td>
<td>Counter</td>
<td>Number of requests that accepted gzip encoding but did not compress because the payload was too small.</td>
</tr>
<tr class="row-even"><td>not_compressed_etag</td>
<td>Counter</td>
<td>Number of requests that were not compressed due to the etag header. <em>disable_on_etag_header</em> must be turned on for this to happen.</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="health_check_filter.html" class="btn btn-neutral float-right" title="Health check" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="grpc_web_filter.html" class="btn btn-neutral" title="gRPC-Web" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>