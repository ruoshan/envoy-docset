

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Route table check tool &mdash; envoy tag-v1.9.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Overload manager" href="../overload_manager/overload_manager.html" />
    <link rel="prev" title="Statistics" href="../statistics.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/v2_overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_filters/network_filters.html">Network filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_filters/http_filters.html">HTTP filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thrift_filters/thrift_filters.html">Thrift filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_manager/cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../health_checkers/health_checkers.html">Health checkers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access_log.html">Access logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limit.html">Rate limit service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statistics.html">Statistics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Route table check tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overload_manager/overload_manager.html">Overload manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secret.html">Secret discovery service (SDS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../well_known_dynamic_metadata.html">Well Known Dynamic Metadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration reference</a> &raquo;</li>
        
      <li>Route table check tool</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/configuration/tools/router_check.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="route-table-check-tool">
<span id="config-tools-router-check-tool"></span><h1>Route table check tool<a class="headerlink" href="#route-table-check-tool" title="Permalink to this headline">¶</a></h1>
<p><strong>NOTE: The following configuration is for the route table check tool only and is not part of the Envoy binary.
The route table check tool is a standalone binary that can be used to verify Envoy’s routing for a given configuration
file.</strong></p>
<p>The following specifies input to the route table check tool. The route table check tool checks if
the route returned by a <a class="reference internal" href="../../api-v2/api/v2/rds.proto.html#envoy-api-msg-routeconfiguration"><span class="std std-ref">router</span></a> matches what is expected.
The tool can be used to check cluster name, virtual cluster name,
virtual host name, manual path rewrite, manual host rewrite, path redirect, and
header field matches. Extensions for other test cases can be added. Details about installing the tool
and sample tool input/output can be found at <a class="reference internal" href="../../install/tools/route_table_check_tool.html#install-tools-route-table-check-tool"><span class="std std-ref">installation</span></a>.</p>
<p>The route table check tool config is composed of an array of json test objects. Each test object is composed of
three parts.</p>
<dl class="docutils">
<dt>Test name</dt>
<dd>This field specifies the name of each test object.</dd>
<dt>Input values</dt>
<dd>The input value fields specify the parameters to be passed to the router. Example input fields include
the :authority, :path, and :method header fields. The :authority and :path fields specify the url
sent to the router and are required. All other input fields are optional.</dd>
<dt>Validate</dt>
<dd>The validate fields specify the expected values and test cases to check. At least one test
case is required.</dd>
</dl>
<p>A simple tool configuration json has one test case and is written as follows. The test
expects a cluster name match of “instant-server”.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;test_name: &quot;</span><span class="n">Cluster_name_test</span><span class="s2">&quot;,</span>
    <span class="s2">&quot;input&quot;</span><span class="p">:</span>
      <span class="p">{</span>
        <span class="s2">&quot;:authority&quot;</span><span class="p">:</span><span class="s2">&quot;api.lyft.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;:path&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/locations&quot;</span>
      <span class="p">},</span>
    <span class="s2">&quot;validate&quot;</span><span class="p">:</span>
      <span class="p">{</span>
        <span class="s2">&quot;cluster_name&quot;</span><span class="p">:</span> <span class="s2">&quot;instant-server&quot;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;test_name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="nt">&quot;input&quot;</span><span class="p">:</span>
      <span class="p">{</span>
        <span class="nt">&quot;:authority&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="nt">&quot;:path&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="nt">&quot;:method&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="nt">&quot;internal&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="nt">&quot;random_value&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ssl&quot;</span> <span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
        <span class="nt">&quot;additional_headers&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
             <span class="nt">&quot;...&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
    <span class="nt">&quot;validate&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;cluster_name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
      <span class="nt">&quot;virtual_cluster_name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
      <span class="nt">&quot;virtual_host_name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
      <span class="nt">&quot;host_rewrite&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
      <span class="nt">&quot;path_rewrite&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
      <span class="nt">&quot;path_redirect&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
      <span class="nt">&quot;header_fields&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;...&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;...&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>test_name</dt>
<dd><em>(required, string)</em> The name of a test object.</dd>
<dt>input</dt>
<dd><p class="first"><em>(required, object)</em> Input values sent to the router that determine the returned route.</p>
<dl class="last docutils">
<dt>:authority</dt>
<dd><em>(required, string)</em> The url authority. This value along with the path parameter define
the url to be matched. An example authority value is “api.lyft.com”.</dd>
<dt>:path</dt>
<dd><em>(required, string)</em> The url path. An example path value is “/foo”.</dd>
<dt>:method</dt>
<dd><em>(optional, string)</em> The request method. If not specified, the default method is GET. The options
are GET, PUT, or POST.</dd>
<dt>internal</dt>
<dd><em>(optional, boolean)</em> A flag that determines whether to set x-envoy-internal to “true”.
If not specified, or if internal is equal to false, x-envoy-internal is not set.</dd>
<dt>random_value</dt>
<dd><em>(optional, integer)</em> An integer used to identify the target for weighted cluster selection.
The default value of random_value is 0.</dd>
<dt>ssl</dt>
<dd><em>(optional, boolean)</em> A flag that determines whether to set x-forwarded-proto to https or http.
By setting x-forwarded-proto to a given protocol, the tool is able to simulate the behavior of
a client issuing a request via http or https. By default ssl is false which corresponds to
x-forwarded-proto set to http.</dd>
<dt>additional_headers</dt>
<dd><p class="first"><em>(optional, array)</em>  Additional headers to be added as input for route determination. The “:authority”,
“:path”, “:method”, “x-forwarded-proto”, and “x-envoy-internal” fields are specified by the other config
options and should not be set here.</p>
<dl class="last docutils">
<dt>field</dt>
<dd><em>(required, string)</em> The name of the header field to add.</dd>
<dt>value</dt>
<dd><em>(required, string)</em> The value of the header field to add.</dd>
</dl>
</dd>
</dl>
</dd>
<dt>validate</dt>
<dd><p class="first"><em>(required, object)</em> The validate object specifies the returned route parameters to match. At least one
test parameter must be specificed. Use “” (empty string) to indicate that no return value is expected.
For example, to test that no cluster match is expected use {“cluster_name”: “”}.</p>
<dl class="last docutils">
<dt>cluster_name</dt>
<dd><em>(optional, string)</em> Match the cluster name.</dd>
<dt>virtual_cluster_name</dt>
<dd><em>(optional, string)</em> Match the virtual cluster name.</dd>
<dt>virtual_host_name</dt>
<dd><em>(optional, string)</em> Match the virtual host name.</dd>
<dt>host_rewrite</dt>
<dd><em>(optional, string)</em> Match the host header field after rewrite.</dd>
<dt>path_rewrite</dt>
<dd><em>(optional, string)</em> Match the path header field after rewrite.</dd>
<dt>path_redirect</dt>
<dd><em>(optional, string)</em> Match the returned redirect path.</dd>
<dt>header_fields</dt>
<dd><p class="first"><em>(optional, array)</em>  Match the listed header fields. Examples header fields include the “:path”, “cookie”,
and “date” fields. The header fields are checked after all other test cases. Thus, the header fields checked
will be those of the redirected or rewriten routes when applicable.</p>
<dl class="last docutils">
<dt>field</dt>
<dd><em>(required, string)</em> The name of the header field to match.</dd>
<dt>value</dt>
<dd><em>(required, string)</em> The value of the header field to match.</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../overload_manager/overload_manager.html" class="btn btn-neutral float-right" title="Overload manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../statistics.html" class="btn btn-neutral" title="Statistics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>