

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Thrift proxy &mdash; envoy tag-v1.9.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Upstream Cluster from SNI" href="sni_cluster_filter.html" />
    <link rel="prev" title="TCP proxy" href="tcp_proxy_filter.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/v2_overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../listener_filters/listener_filters.html">Listener filters</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="network_filters.html">Network filters</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="client_ssl_auth_filter.html">Client TLS authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="echo_filter.html">Echo</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="mongo_proxy_filter.html">Mongo proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Network Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="redis_proxy_filter.html">Redis proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="tcp_proxy_filter.html">TCP proxy</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Thrift proxy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cluster-protocol-options">Cluster Protocol Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thrift-request-metadata">Thrift Request Metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sni_cluster_filter.html">Upstream Cluster from SNI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http_filters/http_filters.html">HTTP filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thrift_filters/thrift_filters.html">Thrift filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_manager/cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../health_checkers/health_checkers.html">Health checkers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access_log.html">Access logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate_limit.html">Rate limit service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime.html">Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statistics.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/router_check.html">Route table check tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overload_manager/overload_manager.html">Overload manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secret.html">Secret discovery service (SDS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../well_known_dynamic_metadata.html">Well Known Dynamic Metadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration reference</a> &raquo;</li>
        
          <li><a href="network_filters.html">Network filters</a> &raquo;</li>
        
      <li>Thrift proxy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/configuration/network_filters/thrift_proxy_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="thrift-proxy">
<span id="config-network-filters-thrift-proxy"></span><h1>Thrift proxy<a class="headerlink" href="#thrift-proxy" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="../../api-v2/config/filter/network/thrift_proxy/v2alpha1/thrift_proxy.proto.html#envoy-api-msg-config-filter-network-thrift-proxy-v2alpha1-thriftproxy"><span class="std std-ref">v2 API reference</span></a></li>
<li>This filter should be configured with the name <em>envoy.filters.network.thrift_proxy</em>.</li>
</ul>
<div class="section" id="cluster-protocol-options">
<h2>Cluster Protocol Options<a class="headerlink" href="#cluster-protocol-options" title="Permalink to this headline">¶</a></h2>
<p>Thrift connections to upstream hosts can be configured by adding an entry to the appropriate
Cluster’s <a class="reference internal" href="../../api-v2/api/v2/cds.proto.html#envoy-api-field-cluster-extension-protocol-options"><span class="std std-ref">extension_protocol_options</span></a>
keyed by <cite>envoy.filters.network.thrift_proxy</cite>. The
<a class="reference internal" href="../../api-v2/config/filter/network/thrift_proxy/v2alpha1/thrift_proxy.proto.html#envoy-api-msg-config-filter-network-thrift-proxy-v2alpha1-thriftprotocoloptions"><span class="std std-ref">ThriftProtocolOptions</span></a>
message describes the available options.</p>
</div>
<div class="section" id="thrift-request-metadata">
<h2>Thrift Request Metadata<a class="headerlink" href="#thrift-request-metadata" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../../api-v2/config/filter/network/thrift_proxy/v2alpha1/thrift_proxy.proto.html#envoy-api-enum-value-config-filter-network-thrift-proxy-v2alpha1-transporttype-header"><span class="std std-ref">HEADER transport</span></a>
and <a class="reference internal" href="../../api-v2/config/filter/network/thrift_proxy/v2alpha1/thrift_proxy.proto.html#envoy-api-enum-value-config-filter-network-thrift-proxy-v2alpha1-protocoltype-twitter"><span class="std std-ref">TWITTER protocol</span></a>
support metadata. In particular, the
<a class="reference external" href="https://github.com/apache/thrift/blob/master/doc/specs/HeaderFormat.md">Header transport</a>
supports informational key/value pairs and the Twitter protocol transmits
<a class="reference external" href="https://github.com/twitter/finagle/blob/master/finagle-thrift/src/main/thrift/tracing.thrift">tracing and request context data</a>.</p>
<div class="section" id="header-transport-metadata">
<h3>Header Transport Metadata<a class="headerlink" href="#header-transport-metadata" title="Permalink to this headline">¶</a></h3>
<p>Header transport key/value pairs are available for routing as
<a class="reference internal" href="../../api-v2/config/filter/network/thrift_proxy/v2alpha1/route.proto.html#envoy-api-field-config-filter-network-thrift-proxy-v2alpha1-routematch-headers"><span class="std std-ref">headers</span></a>.</p>
</div>
<div class="section" id="twitter-protocol-metadata">
<h3>Twitter Protocol Metadata<a class="headerlink" href="#twitter-protocol-metadata" title="Permalink to this headline">¶</a></h3>
<p>Twitter protocol request contexts are converted into headers which are available for routing as
<a class="reference internal" href="../../api-v2/config/filter/network/thrift_proxy/v2alpha1/route.proto.html#envoy-api-field-config-filter-network-thrift-proxy-v2alpha1-routematch-headers"><span class="std std-ref">headers</span></a>.
In addition, the following fields are presented as headers:</p>
<dl class="docutils">
<dt>Client Identifier</dt>
<dd>The ClientId’s <cite>name</cite> field (nested in the RequestHeader <cite>client_id</cite> field) becomes the
<cite>:client-id</cite> header.</dd>
<dt>Destination</dt>
<dd>The RequestHeader <cite>dest</cite> field becomes the <cite>:dest</cite> header.</dd>
<dt>Delegations</dt>
<dd>Each Delegation from the RequestHeader <cite>delegations</cite> field is added as a header. The header
name is the prefix <cite>:d:</cite> followed by the Delegation’s <cite>src</cite>. The value is the Delegation’s
<cite>dst</cite> field.</dd>
</dl>
</div>
<div class="section" id="metadata-interoperability">
<h3>Metadata Interoperability<a class="headerlink" href="#metadata-interoperability" title="Permalink to this headline">¶</a></h3>
<p>Request metadata that is available for routing (see above) is automatically converted between wire
formats when translation between downstream and upstream connections occurs. Twitter protocol
request contexts, client id, destination, and delegations are therefore presented as Header
transport key/value pairs, named as above. Similarly, Header transport key/value pairs are
presented as Twitter protocol RequestContext values, unless they match the special names described
above. For instance, a downstream Header transport request with the info key “:client-id” is
translated to an upstream Twitter protocol request with a ClientId value.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sni_cluster_filter.html" class="btn btn-neutral float-right" title="Upstream Cluster from SNI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tcp_proxy_filter.html" class="btn btn-neutral" title="TCP proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>