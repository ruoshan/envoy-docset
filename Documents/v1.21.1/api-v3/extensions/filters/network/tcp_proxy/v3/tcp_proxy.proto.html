<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TCP Proxy &mdash; envoy tag-v1.21.1 documentation</title>
      <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/css/envoy.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../../" id="documentation_options" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="Thrift Proxy Route Configuration" href="../../thrift_proxy/v3/route.proto.html" />
    <link rel="prev" title="SNI dynamic forward proxy" href="../../sni_dynamic_forward_proxy/v3/sni_dynamic_forward_proxy.proto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../../index.html">
            <img src="../../../../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                tag-v1.21.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../../api/api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/api_supported_versions.html">Supported API versions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../api.html">v3 API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../../bootstrap/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../clusters/clusters.html">Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../http_routes/http_routes.html">HTTP route management</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../../config/config.html">Extensions</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../../../../config/filter/filter.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/accesslog/accesslog.html">Access loggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/accesslog/filters.html">Extension Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/rbac.html">RBAC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/health_checker/health_checker.html">Health checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/transport_socket/transport_socket.html">Transport sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/dns_resolver/dns_resolver.html">DNS Resolver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/resource_monitor/resource_monitor.html">Resource monitors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/common/common.html">Common</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/compression/compression.html">Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/cluster/cluster.html">Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/grpc_credential/grpc_credential.html">Grpc Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/retry/retry.html">Retry Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/trace/trace.html">HTTP Tracers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/internal_redirect/internal_redirect.html">Internal Redirect Predicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/endpoint/endpoint.html">Endpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/upstream/upstream.html">Upstream Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/wasm/wasm.html">WASM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/watchdog/watchdog.html">Watchdog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/descriptors/descriptors.html">Rate limit descriptors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/request_id/request_id.html">Request ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/header_formatters.html">HTTP header formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/original_ip_detection.html">Original IP Detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/http/stateful_session.html">Stateful Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/stat_sinks/stat_sinks.html">Stat sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/quic/quic_extensions.html">Quic Extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/formatter/formatter.html">Access log formatters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/contrib/contrib.html">Contrib Extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../config/rbac/matchers.html">RBAC Matchers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../admin/admin.html">Admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../data/data.html">Envoy data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../service/service.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../common_messages/common_messages.html">Common messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../types/types.html">Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api-docs/xds_protocol.html">xDS REST and gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../api/client_features.html">Well Known Client Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../../../../api/api.html">API</a> &raquo;</li>
          <li><a href="../../../../../api.html">v3 API reference</a> &raquo;</li>
          <li><a href="../../../../../config/config.html">Extensions</a> &raquo;</li>
          <li><a href="../../../../../config/filter/filter.html">Filters</a> &raquo;</li>
          <li><a href="../../../../../config/filter/network/network.html">Network filters</a> &raquo;</li>
      <li>TCP Proxy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../_sources/api-v3/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tcp-proxy">
<span id="envoy-v3-api-file-envoy-extensions-filters-network-tcp-proxy-v3-tcp-proxy-proto"></span><h1>TCP Proxy<a class="headerlink" href="#tcp-proxy" title="Permalink to this headline">¶</a></h1>
<p>This documentation is for the Envoy v3 API.</p>
<p>As of Envoy v1.18 the v2 API has been removed and is no longer supported.</p>
<p>If you are upgrading from v2 API config you may wish to view the v2 API documentation:</p>
<blockquote>
<div><p><a class="reference external" href="https://www.envoyproxy.io/docs/envoy/v1.17.4/api-v2/config/filter/network/tcp_proxy/v2/tcp_proxy.proto.html#envoy-api-file-envoy-config-filter-network-tcp-proxy-v2-tcp-proxy-proto" title="(in envoy vtag-v1.17.4)"><span class="xref std std-ref">config/filter/network/tcp_proxy/v2/tcp_proxy.proto</span></a></p>
</div></blockquote>
<p id="extension-envoy-filters-network-tcp-proxy">This extension may be referenced by the qualified name <code class="docutils literal notranslate"><span class="pre">envoy.filters.network.tcp_proxy</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This extension is intended to be robust against untrusted downstream traffic. It assumes that the upstream is trusted.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This extension extends and can be used with the following extension category:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../../../config/listener/v3/listener_components.proto.html#extension-category-envoy-filters-network"><span class="std std-ref">envoy.filters.network</span></a></p></li>
</ul>
</div>
<p>TCP Proxy <a class="reference internal" href="../../../../../../configuration/listeners/network_filters/tcp_proxy_filter.html#config-network-filters-tcp-proxy"><span class="std std-ref">configuration overview</span></a>.</p>
<div class="section" id="extensions-filters-network-tcp-proxy-v3-tcpproxy">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.21.1/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L26">[extensions.filters.network.tcp_proxy.v3.TcpProxy proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;stat_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;cluster&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;weighted_clusters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;metadata_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;idle_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;access_log&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;max_connect_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;hash_policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;tunneling_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;max_downstream_connection_duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-stat-prefix">
<dt>stat_prefix</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) The prefix to use when emitting <a class="reference internal" href="../../../../../../configuration/listeners/network_filters/tcp_proxy_filter.html#config-network-filters-tcp-proxy-stats"><span class="std std-ref">statistics</span></a>.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster">
<dt>cluster</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>) The upstream cluster to connect to.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster"><span class="std std-ref">cluster</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a> must be set.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters">
<dt>weighted_clusters</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster</span></a>) Multiple upstream clusters can be specified for a given route. The
request is routed to one of the upstream clusters based on weights
assigned to each cluster.</p>
<p>Precisely one of <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-cluster"><span class="std std-ref">cluster</span></a>, <a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weighted-clusters"><span class="std std-ref">weighted_clusters</span></a> must be set.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-metadata-match">
<dt>metadata_match</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-metadata"><span class="std std-ref">config.core.v3.Metadata</span></a>) Optional endpoint metadata match criteria. Only endpoints in the upstream
cluster with metadata matching that set in metadata_match will be
considered. The filter name should be specified as <em>envoy.lb</em>.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-idle-timeout">
<dt>idle_timeout</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) The idle timeout for connections managed by the TCP proxy filter. The idle timeout
is defined as the period in which there are no bytes sent or received on either
the upstream or downstream connection. If not set, the default idle timeout is 1 hour. If set
to 0s, the timeout will be disabled.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Disabling this timeout has a highly likelihood of yielding connection leaks due to lost TCP
FIN packets, etc.</p>
</div>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-access-log">
<dt>access_log</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../config/accesslog/v3/accesslog.proto.html#envoy-v3-api-msg-config-accesslog-v3-accesslog"><span class="std std-ref">config.accesslog.v3.AccessLog</span></a>) Configuration for <a class="reference internal" href="../../../../../../intro/arch_overview/observability/access_logging.html#arch-overview-access-logs"><span class="std std-ref">access logs</span></a>
emitted by the this tcp_proxy.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-max-connect-attempts">
<dt>max_connect_attempts</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#uint32value">UInt32Value</a>) The maximum number of unsuccessful connection attempts that will be made before
giving up. If the parameter is not specified, 1 connection attempt will be made.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-hash-policy">
<dt>hash_policy</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../type/v3/hash_policy.proto.html#envoy-v3-api-msg-type-v3-hashpolicy"><span class="std std-ref">type.v3.HashPolicy</span></a>) Optional configuration for TCP proxy hash policy. If hash_policy is not set, the hash-based
load balancing algorithms will select a host randomly. Currently the number of hash policies is
limited to 1.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunneling-config">
<dt>tunneling_config</dt><dd><p>(<a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig</span></a>) If set, this configures tunneling, e.g. configuration options to tunnel TCP payload over
HTTP CONNECT. If this message is absent, the payload will be proxied upstream as per usual.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-max-downstream-connection-duration">
<dt>max_downstream_connection_duration</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration">Duration</a>) The maximum duration of a connection. The duration is defined as the period since a connection
was established. If not set, there is no max duration. When max_downstream_connection_duration
is reached the connection will be closed. Duration must be at least 1ms.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.21.1/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L33">[extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster proto]</a></p>
<p>Allows for specification of multiple upstream clusters along with weights
that indicate the percentage of traffic to be forwarded to each cluster.
The router selects an upstream cluster based on these weights.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;clusters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusters">
<dt>clusters</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="#envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight"><span class="std std-ref">extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster.ClusterWeight</span></a>, <em>REQUIRED</em>) Specifies one or more upstream clusters associated with the route.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster.ClusterWeight<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.21.1/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L37">[extensions.filters.network.tcp_proxy.v3.TcpProxy.WeightedCluster.ClusterWeight proto]</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;metadata_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{...}&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight-name">
<dt>name</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) Name of the upstream cluster.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight-weight">
<dt>weight</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">uint32</a>) When a request matches the route, the choice of an upstream cluster is
determined by its weight. The sum of weights across all entries in the
clusters array determines the total weight.</p>
</dd>
</dl>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-weightedcluster-clusterweight-metadata-match">
<dt>metadata_match</dt><dd><p>(<a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-metadata"><span class="std std-ref">config.core.v3.Metadata</span></a>) Optional endpoint metadata match criteria used by the subset load balancer. Only endpoints
in the upstream cluster with metadata matching what is set in this field will be considered
for load balancing. Note that this will be merged with what’s provided in
<a class="reference internal" href="#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-metadata-match"><span class="std std-ref">TcpProxy.metadata_match</span></a>, with values
here taking precedence. The filter name should be specified as <em>envoy.lb</em>.</p>
</dd>
</dl>
</div>
<div class="section" id="extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig">
<span id="envoy-v3-api-msg-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig"></span><h2>extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig<a class="headerlink" href="#extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/envoyproxy/envoy/blob/v1.21.1/api/envoy/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#L65">[extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig proto]</a></p>
<p>Configuration for tunneling TCP over other transports or application layers.
Tunneling is supported over both HTTP/1.1 and HTTP/2. Upstream protocol is
determined by the cluster configuration.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;use_post&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;headers_to_add&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl class="simple" id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-hostname">
<dt>hostname</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">string</a>, <em>REQUIRED</em>) The hostname to send in the synthesized CONNECT headers to the upstream proxy.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-use-post">
<dt>use_post</dt><dd><p>(<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto#scalar">bool</a>) Use POST method instead of CONNECT method to tunnel the TCP stream.
The ‘protocol: bytestream’ header is also NOT set for HTTP/2 to comply with the spec.</p>
<p>The upstream proxy is expected to convert POST payload as raw TCP.</p>
</dd>
</dl>
<dl id="envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tunnelingconfig-headers-to-add">
<dt>headers_to_add</dt><dd><p>(<strong>repeated</strong> <a class="reference internal" href="../../../../../config/core/v3/base.proto.html#envoy-v3-api-msg-config-core-v3-headervalueoption"><span class="std std-ref">config.core.v3.HeaderValueOption</span></a>) Additional request headers to upstream proxy. This is mainly used to
trigger upstream to convert POST requests back to CONNECT requests.</p>
<p>Neither <em>:-prefixed</em> pseudo-headers nor the Host: header can be overridden.</p>
</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../sni_dynamic_forward_proxy/v3/sni_dynamic_forward_proxy.proto.html" class="btn btn-neutral float-left" title="SNI dynamic forward proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../thrift_proxy/v3/route.proto.html" class="btn btn-neutral float-right" title="Thrift Proxy Route Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>