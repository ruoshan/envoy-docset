<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic forward proxy &mdash; envoy tag-v1.21.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/envoy.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DynamoDB" href="dynamodb_filter.html" />
    <link rel="prev" title="Decompressor" href="decompressor_filter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/envoy-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                tag-v1.21.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../configuration.html">Configuration reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../listeners/listeners.html">Listeners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../http.html">HTTP</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../http_conn_man/http_conn_man.html">HTTP connection manager</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="http_filters.html">HTTP filters</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adaptive_concurrency_filter.html">Adaptive Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="admission_control_filter.html">Admission Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_lambda_filter.html">AWS Lambda</a></li>
<li class="toctree-l4"><a class="reference internal" href="aws_request_signing_filter.html">AWS Request Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="bandwidth_limit_filter.html">Bandwidth limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="buffer_filter.html">Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="cdn_loop_filter.html">CDN-Loop header</a></li>
<li class="toctree-l4"><a class="reference internal" href="compressor_filter.html">Compressor</a></li>
<li class="toctree-l4"><a class="reference internal" href="composite_filter.html">Composite Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="cors_filter.html">CORS</a></li>
<li class="toctree-l4"><a class="reference internal" href="csrf_filter.html">CSRF</a></li>
<li class="toctree-l4"><a class="reference internal" href="decompressor_filter.html">Decompressor</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Dynamic forward proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="dynamodb_filter.html">DynamoDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="ext_proc_filter.html">External Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="fault_filter.html">Fault Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_bridge_filter.html">gRPC HTTP/1.1 bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_http1_reverse_bridge_filter.html">gRPC HTTP/1.1 reverse bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_json_transcoder_filter.html">gRPC-JSON transcoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_stats_filter.html">gRPC Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="grpc_web_filter.html">gRPC-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="health_check_filter.html">Health check</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_to_metadata_filter.html">Envoy Header-To-Metadata Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="ip_tagging_filter.html">IP Tagging</a></li>
<li class="toctree-l4"><a class="reference internal" href="jwt_authn_filter.html">JWT Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="kill_request_filter.html">Kill Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="local_rate_limit_filter.html">Local rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua_filter.html">Lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="oauth2_filter.html">OAuth2</a></li>
<li class="toctree-l4"><a class="reference internal" href="on_demand_updates_filter.html">On-demand VHDS and S/RDS Updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="original_src_filter.html">Original Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate_limit_filter.html">Rate limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="rbac_filter.html">Role Based Access Control (RBAC) Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="router_filter.html">Router</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_metadata_filter.html">Set Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="squash_filter.html">Squash</a></li>
<li class="toctree-l4"><a class="reference internal" href="sxg_filter.html">SXG</a></li>
<li class="toctree-l4"><a class="reference internal" href="tap_filter.html">Tap</a></li>
<li class="toctree-l4"><a class="reference internal" href="wasm_filter.html">Wasm</a></li>
<li class="toctree-l4"><a class="reference internal" href="stateful_session_filter.html">Stateful session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upstream/upstream.html">Upstream clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../observability/observability.html">Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_features/other_features.html">Other features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other_protocols/other_protocols.html">Other protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/best_practices.html">Configuration best practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/overview.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_history/version_history.html">Version history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">envoy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../configuration.html">Configuration reference</a> &raquo;</li>
          <li><a href="../http.html">HTTP</a> &raquo;</li>
          <li><a href="http_filters.html">HTTP filters</a> &raquo;</li>
      <li>Dynamic forward proxy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/configuration/http/http_filters/dynamic_forward_proxy_filter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="dynamic-forward-proxy">
<span id="config-http-filters-dynamic-forward-proxy"></span><h1>Dynamic forward proxy<a class="headerlink" href="#dynamic-forward-proxy" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>HTTP dynamic forward proxy <a class="reference internal" href="../../../intro/arch_overview/http/http_proxy.html#arch-overview-http-dynamic-forward-proxy"><span class="std std-ref">architecture overview</span></a></p></li>
<li><p><a class="reference internal" href="../../../api-v3/extensions/filters/http/dynamic_forward_proxy/v3/dynamic_forward_proxy.proto.html#envoy-v3-api-msg-extensions-filters-http-dynamic-forward-proxy-v3-filterconfig"><span class="std std-ref">v3 API reference</span></a></p></li>
<li><p>This filter should be configured with the name <em>envoy.filters.http.dynamic_forward_proxy</em></p></li>
</ul>
<p>The following is a complete configuration that configures both the
<a class="reference internal" href="../../../api-v3/extensions/filters/http/dynamic_forward_proxy/v3/dynamic_forward_proxy.proto.html#envoy-v3-api-msg-extensions-filters-http-dynamic-forward-proxy-v3-filterconfig"><span class="std std-ref">dynamic forward proxy HTTP filter</span></a>
as well as the <a class="reference internal" href="../../../api-v3/extensions/clusters/dynamic_forward_proxy/v3/cluster.proto.html#envoy-v3-api-msg-extensions-clusters-dynamic-forward-proxy-v3-clusterconfig"><span class="std std-ref">dynamic forward proxy cluster</span></a>. Both filter and cluster
must be configured together and point to the same DNS cache parameters for Envoy to operate as an
HTTP dynamic forward proxy.</p>
<p>This filter supports <a class="reference internal" href="../../../api-v3/extensions/filters/http/dynamic_forward_proxy/v3/dynamic_forward_proxy.proto.html#envoy-v3-api-msg-extensions-filters-http-dynamic-forward-proxy-v3-filterconfig"><span class="std std-ref">host rewrite</span></a>
via the <a class="reference internal" href="../../../api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-virtualhost-typed-per-filter-config"><span class="std std-ref">virtual host’s typed_per_filter_config</span></a> or the
<a class="reference internal" href="../../../api-v3/config/route/v3/route_components.proto.html#envoy-v3-api-field-config-route-v3-route-typed-per-filter-config"><span class="std std-ref">route’s typed_per_filter_config</span></a>. This can be used to rewrite
the host header with the provided value before DNS lookup, thus allowing to route traffic to the rewritten
host when forwarding. See the example below within the configured routes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Configuring a <a class="reference internal" href="../../../api-v3/config/cluster/v3/cluster.proto.html#envoy-v3-api-field-config-cluster-v3-cluster-transport-socket"><span class="std std-ref">transport_socket with name envoy.transport_sockets.tls</span></a> on the cluster with
<em>trusted_ca</em> certificates instructs Envoy to use TLS when connecting to upstream hosts and verify
the certificate chain. Additionally, Envoy will automatically perform SAN verification for the
resolved host name as well as specify the host name via SNI.</p>
</div>
<blockquote id="dns-cache-circuit-breakers">
<div><p>Dynamic forward proxy uses circuit breakers built in to the DNS cache with the configuration
of <a class="reference internal" href="../../../api-v3/extensions/common/dynamic_forward_proxy/v3/dns_cache.proto.html#envoy-v3-api-field-extensions-common-dynamic-forward-proxy-v3-dnscacheconfig-dns-cache-circuit-breaker"><span class="std std-ref">DNS cache circuit breakers</span></a>.</p>
</div></blockquote>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">admin</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">socket_address</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"></span>
<span class="w">      </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span><span class="w"></span>
<span class="w">      </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9901</span><span class="w"></span>
<span class="nt">static_resources</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">listeners</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">listener_0</span><span class="w"></span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">socket_address</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"></span>
<span class="w">        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span><span class="w"></span>
<span class="w">        </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w"></span>
<span class="w">    </span><span class="nt">filter_chains</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">filters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.http_connection_manager</span><span class="w"></span>
<span class="w">        </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span><span class="w"></span>
<span class="w">          </span><span class="nt">stat_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress_http</span><span class="w"></span>
<span class="w">          </span><span class="nt">route_config</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_route</span><span class="w"></span>
<span class="w">            </span><span class="nt">virtual_hosts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_service</span><span class="w"></span>
<span class="w">              </span><span class="nt">domains</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">              </span><span class="nt">routes</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/force-host-rewrite&quot;</span><span class="w"></span>
<span class="w">                </span><span class="nt">route</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic_forward_proxy_cluster</span><span class="w"></span>
<span class="w">                </span><span class="nt">typed_per_filter_config</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">envoy.filters.http.dynamic_forward_proxy</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.dynamic_forward_proxy.v3.PerRouteConfig</span><span class="w"></span>
<span class="w">                    </span><span class="nt">host_rewrite_literal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.example.org</span><span class="w"></span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"></span>
<span class="w">                </span><span class="nt">route</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic_forward_proxy_cluster</span><span class="w"></span>
<span class="w">          </span><span class="nt">http_filters</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.dynamic_forward_proxy</span><span class="w"></span>
<span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.dynamic_forward_proxy.v3.FilterConfig</span><span class="w"></span>
<span class="w">              </span><span class="nt">dns_cache_config</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic_forward_proxy_cache_config</span><span class="w"></span>
<span class="w">                </span><span class="nt">dns_lookup_family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">V4_ONLY</span><span class="w"></span>
<span class="w">                </span><span class="nt">typed_dns_resolver_config</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.network.dns_resolver.cares</span><span class="w"></span>
<span class="w">                  </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.network.dns_resolver.cares.v3.CaresDnsResolverConfig</span><span class="w"></span>
<span class="w">                    </span><span class="nt">resolvers</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">socket_address</span><span class="p">:</span><span class="w"></span>
<span class="w">                        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8.8.8.8&quot;</span><span class="w"></span>
<span class="w">                        </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span><span class="w"></span>
<span class="w">                    </span><span class="nt">dns_resolver_options</span><span class="p">:</span><span class="w"></span>
<span class="w">                      </span><span class="nt">use_tcp_for_dns_lookups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">                      </span><span class="nt">no_default_search_domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.router</span><span class="w"></span>
<span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.router.v3.Router</span><span class="w"></span>
<span class="w">  </span><span class="nt">clusters</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic_forward_proxy_cluster</span><span class="w"></span>
<span class="w">    </span><span class="nt">lb_policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CLUSTER_PROVIDED</span><span class="w"></span>
<span class="w">    </span><span class="nt">cluster_type</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.clusters.dynamic_forward_proxy</span><span class="w"></span>
<span class="w">      </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.clusters.dynamic_forward_proxy.v3.ClusterConfig</span><span class="w"></span>
<span class="w">        </span><span class="nt">dns_cache_config</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic_forward_proxy_cache_config</span><span class="w"></span>
<span class="w">          </span><span class="nt">dns_lookup_family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">V4_ONLY</span><span class="w"></span>
<span class="w">          </span><span class="nt">typed_dns_resolver_config</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.network.dns_resolver.cares</span><span class="w"></span>
<span class="w">            </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.network.dns_resolver.cares.v3.CaresDnsResolverConfig</span><span class="w"></span>
<span class="w">              </span><span class="nt">resolvers</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">socket_address</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8.8.8.8&quot;</span><span class="w"></span>
<span class="w">                  </span><span class="nt">port_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span><span class="w"></span>
<span class="w">              </span><span class="nt">dns_resolver_options</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">use_tcp_for_dns_lookups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">                </span><span class="nt">no_default_search_domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">transport_socket</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.transport_sockets.tls</span><span class="w"></span>
<span class="w">      </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext</span><span class="w"></span>
<span class="w">        </span><span class="nt">common_tls_context</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">validation_context</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">trusted_ca</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="nv">/etc/ssl/certs/ca-certificates.crt</span><span class="p p-Indicator">}</span><span class="w"></span>
</pre></div>
</div>
<p>Above example is using typed config <a class="reference internal" href="../../../api-v3/extensions/network/dns_resolver/cares/v3/cares_dns_resolver.proto.html#envoy-v3-api-msg-extensions-network-dns-resolver-cares-v3-caresdnsresolverconfig"><span class="std std-ref">CaresDnsResolverConfig</span></a>.
To use <a class="reference internal" href="../../../api-v3/extensions/network/dns_resolver/apple/v3/apple_dns_resolver.proto.html#envoy-v3-api-msg-extensions-network-dns-resolver-apple-v3-applednsresolverconfig"><span class="std std-ref">AppleDnsResolverConfig</span></a> (iOS/macOS only), follow below example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">typed_dns_resolver_config</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envoy.network.dns_resolver.apple</span><span class="w"></span>
<span class="w">  </span><span class="nt">typed_config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.network.dns_resolver.apple.v3.AppleDnsResolverConfig</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>The dynamic forward proxy DNS cache outputs statistics in the dns_cache.&lt;dns_cache_name&gt;.*
namespace.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dns_query_attempt</p></td>
<td><p>Counter</p></td>
<td><p>Number of DNS query attempts.</p></td>
</tr>
<tr class="row-odd"><td><p>dns_query_success</p></td>
<td><p>Counter</p></td>
<td><p>Number of DNS query successes.</p></td>
</tr>
<tr class="row-even"><td><p>dns_query_failure</p></td>
<td><p>Counter</p></td>
<td><p>Number of DNS query failures.</p></td>
</tr>
<tr class="row-odd"><td><p>dns_query_timeout</p></td>
<td><p>Counter</p></td>
<td><p>Number of DNS query <a class="reference internal" href="../../../api-v3/extensions/common/dynamic_forward_proxy/v3/dns_cache.proto.html#envoy-v3-api-field-extensions-common-dynamic-forward-proxy-v3-dnscacheconfig-dns-query-timeout"><span class="std std-ref">timeouts</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p>host_address_changed</p></td>
<td><p>Counter</p></td>
<td><p>Number of DNS queries that resulted in a host address change.</p></td>
</tr>
<tr class="row-odd"><td><p>host_added</p></td>
<td><p>Counter</p></td>
<td><p>Number of hosts that have been added to the cache.</p></td>
</tr>
<tr class="row-even"><td><p>host_removed</p></td>
<td><p>Counter</p></td>
<td><p>Number of hosts that have been removed from the cache.</p></td>
</tr>
<tr class="row-odd"><td><p>num_hosts</p></td>
<td><p>Gauge</p></td>
<td><p>Number of hosts that are currently in the cache.</p></td>
</tr>
<tr class="row-even"><td><p>dns_rq_pending_overflow</p></td>
<td><p>Counter</p></td>
<td><p>Number of dns pending request overflow.</p></td>
</tr>
</tbody>
</table>
<p>The dynamic forward proxy DNS cache circuit breakers outputs statistics in the dns_cache.&lt;dns_cache_name&gt;.circuit_breakers*
namespace.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>rq_pending_open</p></td>
<td><p>Gauge</p></td>
<td><p>Whether the requests circuit breaker is closed (0) or open (1)</p></td>
</tr>
<tr class="row-odd"><td><p>rq_pending_remaining</p></td>
<td><p>Gauge</p></td>
<td><p>Number of remaining requests until the circuit breaker opens</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="decompressor_filter.html" class="btn btn-neutral float-left" title="Decompressor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dynamodb_filter.html" class="btn btn-neutral float-right" title="DynamoDB" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Envoy Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>